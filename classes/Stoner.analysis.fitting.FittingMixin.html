
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FittingMixin &#8212; Stoner Pacakge API Documentation</title>
    <link rel="stylesheet" href="../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Additional Fitting models" href="../analysis-fitting.html" />
    <link rel="prev" title="odr_Model" href="Stoner.analysis.fitting.odr_Model.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../index.html ">
        Stoner Pacakge API Documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="Stoner.analysis.fitting.odr_Model.html" title="Previous document">odr_Model</a>
        </li>
        <li>
          <a href="../analysis-fitting.html" title="Next document">Additional Fitting models</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="../Stoner.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner</span></code> Package</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fittingmixin">
<h1>FittingMixin<a class="headerlink" href="#fittingmixin" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="Stoner.analysis.fitting.FittingMixin">
<em class="property">class </em><code class="sig-prename descclassname">Stoner.analysis.fitting.</code><code class="sig-name descname">FittingMixin</code><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A mixin calss for <a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> to provide additional curve_fiotting methods.</p>
<p class="rubric">Methods Summary</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.annotate_fit" title="Stoner.analysis.fitting.FittingMixin.annotate_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">annotate_fit</span></code></a>(model[, x, y, z, text_only])</p></td>
<td><p>Annotate a plot with some information about a fit.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.curve_fit" title="Stoner.analysis.fitting.FittingMixin.curve_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">curve_fit</span></code></a>(func[, xcol, ycol, sigma])</p></td>
<td><p>General curve fitting function passed through from scipy.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.differential_evolution" title="Stoner.analysis.fitting.FittingMixin.differential_evolution"><code class="xref py py-obj docutils literal notranslate"><span class="pre">differential_evolution</span></code></a>(model[, xcol, ycol, …])</p></td>
<td><p>Fit model to the data using a differential evolution algorithm.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.lmfit" title="Stoner.analysis.fitting.FittingMixin.lmfit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lmfit</span></code></a>(model[, xcol, ycol, p0, sigma])</p></td>
<td><p>Wrap the lmfit module fitting.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.odr" title="Stoner.analysis.fitting.FittingMixin.odr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">odr</span></code></a>(model[, xcol, ycol])</p></td>
<td><p>Wrap the scipy.odr orthogonal distance regression fitting.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Stoner.analysis.fitting.FittingMixin.polyfit" title="Stoner.analysis.fitting.FittingMixin.polyfit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">polyfit</span></code></a>([xcol, ycol, polynomial_order, …])</p></td>
<td><p>Pass through to numpy.polyfit.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.annotate_fit">
<code class="sig-name descname">annotate_fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">x</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">y</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">z</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">text_only</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.annotate_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.annotate_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Annotate a plot with some information about a fit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mode</strong> (<em>callable or lmfit.Model</em>) – The function/model used to describe the fit to be annotated.</p>
</dd>
</dl>
<dl class="simple">
<dt>Keyword Parameters:</dt><dd><dl class="simple">
<dt>x (float):</dt><dd><p>x co-ordinate of the label</p>
</dd>
<dt>y (float):</dt><dd><p>y co-ordinate of the label</p>
</dd>
<dt>z (float):</dt><dd><p>z co-ordinbate of the label if the current axes are 3D</p>
</dd>
<dt>prefix (str):</dt><dd><p>The prefix placed ahead of the model parameters in the metadata.</p>
</dd>
<dt>text_only (bool):</dt><dd><p>If False (default), add the text to the plot and return the current object, otherwise,
return just the text and don’t add to a plot.</p>
</dd>
<dt>prefix(str):</dt><dd><p>If given  overridges the prefix from the model to determine a prefix to the parameter names in the
metadata</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><em>(Datam, str)</em> –     A copy of the current Data instance if text_only is False, otherwise returns the text.</p>
</dd>
</dl>
<p>If <em>prefix</em> is not given, then the first prefix in the metadata lmfit.prefix is used if present,
otherwise a prefix is generated from the model.prefix attribute. If <em>x</em> and <em>y</em> are not specified then they
are set to be 0.75 * maximum x and y limit of the plot.</p>
</dd></dl>

<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.curve_fit">
<code class="sig-name descname">curve_fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">xcol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ycol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.curve_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.curve_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>General curve fitting function passed through from scipy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable, lmfit.Model, odr.Model</em>) – The fitting function with the form def f(x,*p) where p is a list of fitting parameters</p></li>
<li><p><strong>xcol</strong> (<em>index, Iterable</em>) – The index of the x-column data to fit. If list or other iterable sends a tuple of x columns to func
for N-d fitting.</p></li>
<li><p><strong>ycol</strong> (<em>index, list of indices or array</em>) – The index of the y-column data to fit. If an array, then should be 1D and
the same length as the data. If ycol is a list of indices then the columns are iterated over in
turn, fitting occuring for each one. In this case the return value is a list of what would be
returned for a single column fit.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>p0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a><em>, </em><a class="reference internal" href="../Stoner.html#module-Stoner.core.array" title="Stoner.core.array"><em>array</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A vector of initial parameter values to try. See notes below.</p></li>
<li><p><strong>sigma</strong> (<a class="reference internal" href="Stoner.Core.DataFile.index.html#Stoner.Core.DataFile.index" title="Stoner.Core.DataFile.index"><em>index</em></a>) – The index of the column with the y-error bars</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A callable object that evaluates true if a row is to be included. Should be of the form f(x,y)</p></li>
<li><p><strong>result</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Determines whether the fitted data should be added into the DataFile object. If result is True then
the last column will be used. If result is a string or an integer then it is used as a column index.
Default to None for not adding fitted data</p></li>
<li><p><strong>replace</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Inidcatesa whether the fitted data replaces existing data or is inserted as a new column (default
False)</p></li>
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/string.html#module-string" title="(in Python v3.9)"><em>string</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><em>None</em></a>) – If this is a string then it is used as the name of the fitted data. (default None)</p></li>
<li><p><strong>absolute_sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – If False, <cite>sigma</cite> denotes relative weights of the data points. The default True means that
the sigma parameter is the reciprocal of the absoluate standard deviation.</p></li>
<li><p><strong>output</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>default &quot;fit&quot;</em>) – Specifiy what to return.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p><em>(various)</em> –</p>
<dl class="simple">
<dt>The return value is determined by the <em>output</em> parameter. Options are:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>”fit”    (tuple of popt,pcov) Optimal values of the fitting parameters p, and the</dt><dd><p>variance-co-variance matrix for the fitting parameters.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”row”     just a one dimensional numpy array of the fit paraeters interleaved with their</dt><dd><p>uncertainties</p>
</dd>
</dl>
</li>
<li><p>”full”    a tuple of (popt,pcov,dictionary of optional outputs, message, return code, row).</p></li>
<li><dl class="simple">
<dt>”data”   a copy of the <a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> object with fit recorded in the</dt><dd><p>metadata and optionally as a new column.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the columns are not specified (or set to None) then the X and Y data are taken using the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> attribute.</p>
<p>The fitting function should have prototype y=f(x,p[0],p[1],p[2]…)
The x-column and y-column can be anything that <a class="reference internal" href="Stoner.Core.DataFile.find_col.html#Stoner.Core.DataFile.find_col" title="Stoner.Core.DataFile.find_col"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.find_col()</span></code></a> can use as an index
but typucally either strings to be matched against column headings or integers.
The initial parameter values and weightings default to None which corresponds to all parameters starting
at 1 and all points equally weighted. The bounds function has format b(x, y-vec) and rewturns true if the
point is to be used in the fit and false if not.</p>
<p>The <em>absolute_sigma</em> keyword determines whether the returned covariance matrix <cite>pcov</cite> is based on
<em>estimated</em> errors in the data, and is not affected by the overall magnitude of the values in <cite>sigma</cite>.
Only the relative magnitudes of the <em>sigma</em> values matter.
If True, <cite>sigma</cite> describes one standard deviation errors of the input data points. The estimated
covariance in <cite>pcov</cite> is based on these values.</p>
<p>The starting vector <em>p0</em> can be either a list, tuple or array, or a callable that will produce a list,
tuple or array. IF callable, it should take the form:</p>
<blockquote>
<div><dl class="simple">
<dt>def p0_func(ydata,x=xdata):</dt><dd></dd>
</dl>
</div></blockquote>
<p>and return a list of parameter values that is in the same order as the model function. If p0 is not
given and a <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.Model</span></code> or <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.odr.Model.html#scipy.odr.Model" title="(in SciPy v1.5.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.odr.Model</span></code></a> is supplied as the model function,
then the model’s estimates of the starting values will be used instead.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="Stoner.Data.lmfit.html#Stoner.Data.lmfit" title="Stoner.Data.lmfit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.lmfit()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.odr.html#Stoner.Data.odr" title="Stoner.Data.odr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.odr()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.differential_evolution.html#Stoner.Data.differential_evolution" title="Stoner.Data.differential_evolution"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.differential_evolution()</span></code></a></p></li>
<li><p>User guide section <a class="reference internal" href="../UserGuide/curve_fitting.html#curve-fit-guide"><span class="std std-ref">Curve Fitting in the Stoner Pacakge</span></a></p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.differential_evolution">
<code class="sig-name descname">differential_evolution</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">xcol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ycol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">p0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.differential_evolution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.differential_evolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit model to the data using a differential evolution algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>lmfit.Model</em>) – An instance of an lmfit.Model that represents the model to be fitted to the data</p></li>
<li><p><strong>xcol</strong> (<em>index or None</em>) – Columns to be used for the x  data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> x column</p></li>
<li><p><strong>ycol</strong> (<em>index or None</em>) – Columns to be used for the  y data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> y column</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>p0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a><em>, </em><a class="reference internal" href="../Stoner.html#module-Stoner.core.array" title="Stoner.core.array"><em>array</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A vector of initial parameter values to try. See the notes in <a class="reference internal" href="Stoner.Data.curve_fit.html#Stoner.Data.curve_fit" title="Stoner.Data.curve_fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.curve_fit()</span></code></a> for
more details.</p></li>
<li><p><strong>sigma</strong> (<a class="reference internal" href="Stoner.Core.DataFile.index.html#Stoner.Core.DataFile.index" title="Stoner.Core.DataFile.index"><em>index</em></a>) – The index of the column with the y-error bars</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A callable object that evaluates true if a row is to be included. Should be of the form f(x,y)</p></li>
<li><p><strong>result</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Determines whether the fitted data should be added into the DataFile object. If result is True then
the last column will be used. If result is a string or an integer then it is used as a column index.
Default to None for not adding fitted data</p></li>
<li><p><strong>replace</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Inidcatesa whether the fitted data replaces existing data or is inserted as a new column (default
False)</p></li>
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/string.html#module-string" title="(in Python v3.9)"><em>string</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><em>None</em></a>) – If this is a string then it is used as the name of the fitted data. (default None)</p></li>
<li><p><strong>scale_covar</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether to automatically scale covariance matrix (leastsq only)</p></li>
<li><p><strong>output</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>default &quot;fit&quot;</em>) – Specifiy what to return.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p><em>( various )</em> –</p>
<dl class="simple">
<dt>The return value is determined by the <em>output</em> parameter. Options are</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>”fit”    just the <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.model.ModelFit</span></code> instance that contains all relevant</dt><dd><p>information about the fit.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”row”     just a one dimensional numpy array of the fit paraeters interleaved with their</dt><dd><p>uncertainties</p>
</dd>
</dl>
</li>
<li><p>”full”    a tuple of the fit instance and the row.</p></li>
<li><dl class="simple">
<dt>”data”    a copy of the <a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> object with the fit recorded in the</dt><dd><p>emtadata and optinally as a column of data.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
<p>This function is essentially a wrapper around the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.differential_evolution.html#scipy.optimize.differential_evolution" title="(in SciPy v1.5.4)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.differential_evolution()</span></code></a> funtion
that presents the same interface as the other Stoner package curve fitting functions. The parent function,
however, does not provide the variance-covariance matrix to estimate the fitting errors. To work around this,
this function does the initial fit with the differential evolution, but then uses that to give a starting
vector to a call to <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit" title="(in SciPy v1.5.4)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit()</span></code></a> to calculate the covariance matrix.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="Stoner.Data.curve_fit.html#Stoner.Data.curve_fit" title="Stoner.Data.curve_fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.curve_fit()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.lmfit.html#Stoner.Data.lmfit" title="Stoner.Data.lmfit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.lmfit()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.odr.html#Stoner.Data.odr" title="Stoner.Data.odr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.odr()</span></code></a></p></li>
<li><p>User guide section <a class="reference internal" href="../UserGuide/curve_fitting.html#curve-fit-guide"><span class="std std-ref">Curve Fitting in the Stoner Pacakge</span></a></p></li>
</ul>
</div>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Simple use of lmfit to fit data.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">random</span>

<span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>

<span class="c1"># Make some data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mf">1.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Signal&quot;</span><span class="p">],</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>

<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span>  <span class="c1"># plot our data</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">C</span><span class="p">)</span>


<span class="c1"># Do the fitting and plot the result</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">,</span>
    <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">B</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
    <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Reset labels</span>
<span class="n">d</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Make nice two panel plot layout</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;x..y&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;g+&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;xyy&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r.&quot;</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="n">d</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Annotate plot with fitting parameters</span>
<span class="n">d</span><span class="o">.</span><span class="n">annotate_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y=A+Be^{-x/C}$&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">7.2</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Differential Evolution  Fit&quot;</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../samples/diffev1.png">png</a>, <a class="reference external" href="../samples/diffev1.hires.png">hires.png</a>, <a class="reference external" href="../samples/diffev1.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/diffev1.png" src="../_images/diffev1.png" />
</div>
</dd></dl>

<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.lmfit">
<code class="sig-name descname">lmfit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">xcol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ycol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">p0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sigma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.lmfit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.lmfit" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap the lmfit module fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>lmfit.Model</em>) – An instance of an lmfit.Model that represents the model to be fitted to the data</p></li>
<li><p><strong>xcol</strong> (<em>index or None</em>) – Columns to be used for the x  data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> x column</p></li>
<li><p><strong>ycol</strong> (<em>index or None</em>) – Columns to be used for the  y data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> y column</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>p0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a><em>, </em><a class="reference internal" href="../Stoner.html#module-Stoner.core.array" title="Stoner.core.array"><em>array</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A vector of initial parameter values to try. See the notes in <a class="reference internal" href="Stoner.Data.curve_fit.html#Stoner.Data.curve_fit" title="Stoner.Data.curve_fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.curve_fit()</span></code></a> for
more details.</p></li>
<li><p><strong>sigma</strong> (<a class="reference internal" href="Stoner.Core.DataFile.index.html#Stoner.Core.DataFile.index" title="Stoner.Core.DataFile.index"><em>index</em></a>) – The index of the column with the y-error bars</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A callable object that evaluates true if a row is to be included. Should be of the form f(x,y)</p></li>
<li><p><strong>result</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Determines whether the fitted data should be added into the DataFile object. If result is True then
the last column will be used. If result is a string or an integer then it is used as a column index.
Default to None for not adding fitted data</p></li>
<li><p><strong>replace</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Inidcatesa whether the fitted data replaces existing data or is inserted as a new column (default
False)</p></li>
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/string.html#module-string" title="(in Python v3.9)"><em>string</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><em>None</em></a>) – If this is a string then it is used as the name of the fitted data. (default None)</p></li>
<li><p><strong>scale_covar</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether to automatically scale covariance matrix (leastsq only)</p></li>
<li><p><strong>output</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>default &quot;fit&quot;</em>) – Specifiy what to return.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p><em>( various )</em> –</p>
<dl class="simple">
<dt>The return value is determined by the <em>output</em> parameter. Options are</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>”fit”    just the <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.model.ModelFit</span></code> instance that contains all relevant</dt><dd><p>information about the fit.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”row”     just a one dimensional numpy array of the fit paraeters interleaved with their</dt><dd><p>uncertainties</p>
</dd>
</dl>
</li>
<li><p>”full”    a tuple of the fit instance and the row.</p></li>
<li><dl class="simple">
<dt>”data”    a copy of the <a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> object with the fit recorded in the</dt><dd><p>emtadata and optinally as a column of data.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="Stoner.Data.curve_fit.html#Stoner.Data.curve_fit" title="Stoner.Data.curve_fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.curve_fit()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.odr.html#Stoner.Data.odr" title="Stoner.Data.odr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.odr()</span></code></a></p></li>
<li><p><a class="reference internal" href="Stoner.Data.differential_evolution.html#Stoner.Data.differential_evolution" title="Stoner.Data.differential_evolution"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.differential_evolution()</span></code></a></p></li>
<li><p>User guide section <a class="reference internal" href="../UserGuide/curve_fitting.html#fitting-with-limits"><span class="std std-ref">Fitting with limits</span></a></p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <em>p0</em> is fed a 2D array, then it assumed that you want to calculate <span class="math notranslate nohighlight">\(\chi^2\)</span> for different
starting parameters with some variables fixed. In this mode, fitting is carried out repeatedly with each
row representing one attempt with different values of the parameters. In this mode the return value is
a 2D array whose rows correspond to the inputs to the rows of p0, the columns are the fitted values of the
parameters with an additional column for <span class="math notranslate nohighlight">\(\chi^2\)</span>.</p>
</div>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Simple use of lmfit to fit data.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">random</span>

<span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>

<span class="c1"># Make some data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mf">1.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Signal&quot;</span><span class="p">],</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>

<span class="c1"># Do the fitting and plot the result</span>
<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">C</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">lmfit</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">,</span>
    <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">B</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;report&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Reset labels</span>
<span class="n">d</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Make nice two panel plot layout</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;x..y&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;g+&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;xyy&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="n">d</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Annotate plot with fitting parameters</span>
<span class="n">d</span><span class="o">.</span><span class="n">annotate_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">7.2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y=A+Be^{-x/C}$&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">7.2</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Levenberg-Marquardt Fit&quot;</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../samples/lmfit2.png">png</a>, <a class="reference external" href="../samples/lmfit2.hires.png">hires.png</a>, <a class="reference external" href="../samples/lmfit2.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/lmfit2.png" src="../_images/lmfit2.png" />
</div>
</dd></dl>

<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.odr">
<code class="sig-name descname">odr</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">xcol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ycol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.odr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.odr" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap the scipy.odr orthogonal distance regression fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>scipy.odr.Model, lmfit.models.Model or callable</em>) – Tje model that describes the data. See below for more details.</p></li>
<li><p><strong>xcol</strong> (<em>index or None</em>) – Columns to be used for the x  data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> x column</p></li>
<li><p><strong>ycol</strong> (<em>index or None</em>) – Columns to be used for the  y data for the fitting. If not givem defaults to the
<a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile.setas" title="Stoner.Core.DataFile.setas"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.setas</span></code></a> y column</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>p0</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a><em>, </em><a class="reference internal" href="../Stoner.html#module-Stoner.core.array" title="Stoner.core.array"><em>array</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A vector of initial parameter values to try. See the notes to <a class="reference internal" href="Stoner.Data.curve_fit.html#Stoner.Data.curve_fit" title="Stoner.Data.curve_fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.curve_fit()</span></code></a> for
more details.</p></li>
<li><p><strong>sigma_x</strong> (<a class="reference internal" href="Stoner.Core.DataFile.index.html#Stoner.Core.DataFile.index" title="Stoner.Core.DataFile.index"><em>index</em></a>) – The index of the column with the x-error bars</p></li>
<li><p><strong>sigma_y</strong> (<a class="reference internal" href="Stoner.Core.DataFile.index.html#Stoner.Core.DataFile.index" title="Stoner.Core.DataFile.index"><em>index</em></a>) – The index of the column with the x-error bars</p></li>
<li><p><strong>bounds</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.9)"><em>callable</em></a>) – A callable object that evaluates true if a row is to be included. Should be of the form f(x,y)</p></li>
<li><p><strong>result</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Determines whether the fitted data should be added into the DataFile object. If result is True then
the last column will be used. If result is a string or an integer then it is used as a column index.
Default to None for not adding fitted data</p></li>
<li><p><strong>replace</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Inidcatesa whether the fitted data replaces existing data or is inserted as a new column
(default False)</p></li>
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/string.html#module-string" title="(in Python v3.9)"><em>string</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><em>None</em></a>) – If this is a string then it is used as the name of the fitted data. (default None)</p></li>
<li><p><strong>output</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>default &quot;fit&quot;</em>) – Specifiy what to return.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p><em>( various )</em> –</p>
<dl>
<dt>The return value is determined by the <em>output</em> parameter. Options are</dt><dd><ul>
<li><p>”fit”    just the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.odr.Output.html#scipy.odr.Output" title="(in SciPy v1.5.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.odr.Output</span></code></a> instance (default)</p></li>
<li><dl class="simple">
<dt>”row”     just a one dimensional numpy array of the fit paraeters interleaved with their</dt><dd><p>uncertainties</p>
</dd>
</dl>
</li>
<li><p>”full”    a tuple of the fit instance and the row.</p></li>
<li><dl>
<dt>”data”    a copy of the <a class="reference internal" href="Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> object with the fit recorded in the</dt><dd><blockquote>
<div><p>emtadata and optinally</p>
</div></blockquote>
<p>as a column of data.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function tries to make use of whatever model you give it. Specifically, it accepts:</p>
<blockquote>
<div><ul class="simple">
<li><p>A subclass or an instance of <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.odr.Model.html#scipy.odr.Model" title="(in SciPy v1.5.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.odr.Model</span></code></a> : this is the native model type for the
underlying scipy odr package.</p></li>
<li><p>A subclass or instance of an lmfit.models.Model: the <code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner.analysis.fitting.models</span></code>
package has a number of useful prebuilt lmfit models that can be used directly by this function.</p></li>
<li><p>A callable function which should have a signature f(x,parameter1,parameter2…) and <em>not</em> the
scip.odr stadnard f(beta,x)</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>This function ois designed to be as compatible as possible with <code class="xref py py-meth docutils literal notranslate"><span class="pre">AnalysisMixin.curve_fit()</span></code> and</dt><dd><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">AnalysisMixin.lmfit()</span></code> to facilitate easy of switching between them.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">AnalysisMixin.curve_fit()</span></code></p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">AnalysisMixin.lmfit()</span></code></p></li>
<li><p><a class="reference internal" href="Stoner.Data.differential_evolution.html#Stoner.Data.differential_evolution" title="Stoner.Data.differential_evolution"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Data.differential_evolution()</span></code></a></p></li>
<li><p>User guide section <a class="reference internal" href="../UserGuide/curve_fitting.html#fitting-with-limits"><span class="std std-ref">Fitting with limits</span></a></p></li>
</ul>
</div>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Simple use of lmfit to fit data.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">Stoner.plot.utils</span> <span class="kn">import</span> <span class="n">errorfill</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">random</span>

<span class="c1"># Make some data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="mf">1.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="o">+</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Signal&quot;</span><span class="p">],</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>

<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span>  <span class="c1"># plot our data</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">C</span><span class="p">)</span>

<span class="c1"># Do the fitting and plot the result</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">odr</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">,</span>
    <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">B</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
    <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Reset labels</span>
<span class="n">d</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Make nice two panel plot layout</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;x..y&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;g+&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Plot up the data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;xy&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;x.y&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="n">errorfill</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="n">errorfill</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="n">d</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Annotate plot with fitting parameters</span>
<span class="n">d</span><span class="o">.</span><span class="n">annotate_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y=A+Be^{-x/C}$&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">7.2</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;x-small&quot;</span><span class="p">})</span>
<span class="n">d</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Orthogonal Distance Regression  Fit&quot;</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../samples/odrfit1.png">png</a>, <a class="reference external" href="../samples/odrfit1.hires.png">hires.png</a>, <a class="reference external" href="../samples/odrfit1.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/odrfit1.png" src="../_images/odrfit1.png" />
</div>
</dd></dl>

<dl class="py method">
<dt id="Stoner.analysis.fitting.FittingMixin.polyfit">
<code class="sig-name descname">polyfit</code><span class="sig-paren">(</span><em class="sig-param">xcol=None</em>, <em class="sig-param">ycol=None</em>, <em class="sig-param">polynomial_order=2</em>, <em class="sig-param">bounds=&lt;function FittingMixin.&lt;lambda&gt;&gt;</em>, <em class="sig-param">result=None</em>, <em class="sig-param">replace=False</em>, <em class="sig-param">header=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Stoner/analysis/fitting/mixins.html#FittingMixin.polyfit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Stoner.analysis.fitting.FittingMixin.polyfit" title="Permalink to this definition">¶</a></dt>
<dd><p>Pass through to numpy.polyfit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xcol</strong> (<em>index</em>) – Index to the column in the data with the X data in it</p></li>
<li><p><strong>ycol</strong> (<em>index</em>) – Index to the column int he data with the Y data in it</p></li>
<li><p><strong>polynomial_order</strong> (<em>int</em>) – Order of polynomial to fit (default 2)</p></li>
<li><p><strong>bounds</strong> (<em>callable</em>) – A function that evaluates True if the current row should be included in the fit</p></li>
<li><p><strong>result</strong> (<em>index or None</em>) – Add the fitted data to the current data object in a new column (default don’t add)</p></li>
<li><p><strong>replace</strong> (<em>bool</em>) – Overwrite or insert new data if result is not None (default False)</p></li>
<li><p><strong>header</strong> (<em>string or None</em>) – Name of column_header of replacement data. Default is construct a string from the y column
headser and polynomial order.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>(numpy.poly)</em> –     The best fit polynomial as a numpy.poly object.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the x or y columns are not specified (or are None) the the setas attribute is used instead.</p>
<dl class="simple">
<dt>This method is depricated and may be removed in a future version in favour of the more general</dt><dd><p>curve_fit</p>
</dd>
</dl>
</div>
</dd></dl>

</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/StonerLogo2.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="Stoner.analysis.fitting.odr_Model.html"
                        title="previous chapter">odr_Model</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../analysis-fitting.html"
                        title="next chapter">Additional Fitting models</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/classes/Stoner.analysis.fitting.FittingMixin.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form class="search" action="../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="Stoner.analysis.fitting.odr_Model.html" title="Previous document">odr_Model</a>
        </li>
        <li>
          <a href="../analysis-fitting.html" title="Next document">Additional Fitting models</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="../Stoner.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner</span></code> Package</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2013-15, Gavin Burnell et al.Last updated on Dec 21, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      3.2.1
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>