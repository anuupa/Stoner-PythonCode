
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cookbook &#8212; Stoner Pacakge API Documentation</title>
    <link rel="stylesheet" href="../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ConvertingScripts from Older Versions of the Stoner Package" href="upgrade.html" />
    <link rel="prev" title="Working with Images" href="image.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../index.html ">
        Stoner Pacakge API Documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="image.html" title="Previous document">Working with Images</a>
        </li>
        <li>
          <a href="upgrade.html" title="Next document">ConvertingScripts from Older Versions of the Stoner Package</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="ugindex.html">The Stoner Python Package User Guide</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cookbook">
<h1>Cookbook<a class="headerlink" href="#cookbook" title="Permalink to this headline">¶</a></h1>
<p>This section gives some short examples to give an idea of things that can be
done with the Stoner python module in just a few lines.</p>
<div class="section" id="the-util-module">
<h2>The Util module<a class="headerlink" href="#the-util-module" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Stoner</strong> package comes with an extra <code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner.Util</span></code> module that includes some handy utility
functions.</p>
<div class="section" id="the-data-class">
<h3>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code> Class<a class="headerlink" href="#the-data-class" title="Permalink to this headline">¶</a></h3>
<p>In practice, one often requires both the analysis functions of <a class="reference internal" href="../classes/Stoner.Analysis.AnalysisMixin.html#Stoner.Analysis.AnalysisMixin" title="Stoner.Analysis.AnalysisMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Analysis.AnalysisMixin</span></code></a> and
the plotting functions of <a class="reference internal" href="../classes/Stoner.plot.PlotMixin.html#Stoner.plot.PlotMixin" title="Stoner.plot.PlotMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.plot.PlotMixin</span></code></a>. This can be done easily by creating a
subclass that inherits from both, but for convenience, the <code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner.Util</span></code> module provides the <code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code>
class that does this for you.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner.Core</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="n">d</span><span class="o">=</span><span class="n">Data</span><span class="p">(</span><span class="s2">&quot;File-of-data.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="splitting-data-into-rising-and-falling-values">
<h3>Splitting Data into rising and falling values<a class="headerlink" href="#splitting-data-into-rising-and-falling-values" title="Permalink to this headline">¶</a></h3>
<p>So far the module just contains one function that will take a single <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a>
object and split it into a series of <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> objects where one column is either
rising or falling. This is designed to help deal with analysis problems involving hysteretic data.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner.Util</span> <span class="kn">import</span> <span class="n">split_up_down</span>
<span class="n">folder</span><span class="o">=</span><span class="n">split_up_down</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">column</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example <em>folder</em> is a <a class="reference internal" href="../classes/Stoner.Folders.DataFolder.html#Stoner.Folders.DataFolder" title="Stoner.Folders.DataFolder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Folders.DataFolder</span></code></a> instance with two groups, one for rising values of the column
and one for falling values of the column. The <a class="reference internal" href="../classes/Stoner.Util.split_up_down.html#Stoner.Util.split_up_down" title="Stoner.Util.split_up_down"><code class="xref py py-func docutils literal notranslate"><span class="pre">split_up_down()</span></code></a> will take an optional third parameter
which is an existing <code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFolder</span></code> instance to which the new groups (if they
don’t already exist) and files will be added.</p>
</div>
<div class="section" id="analysis-of-hysteresis-loops">
<h3>Analysis of Hysteresis Loops<a class="headerlink" href="#analysis-of-hysteresis-loops" title="Permalink to this headline">¶</a></h3>
<p>Since much of our group’s work is concerned with measuring magnetic hystersis loops, the <a class="reference internal" href="../classes/Stoner.Util.hysteresis_correct.html#Stoner.Util.hysteresis_correct" title="Stoner.Util.hysteresis_correct"><code class="xref py py-func docutils literal notranslate"><span class="pre">hysteresis_correct()</span></code></a> function
provides a handy way to correct some instrumental artifacts and measure properties of hysteresis loops.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner.Util</span> <span class="kn">import</span> <span class="n">hysteresis_correct</span>
<span class="n">d</span><span class="o">=</span><span class="n">hysteresis_correct</span><span class="p">(</span><span class="s1">&#39;QD-SQUID-VSM.dat&#39;</span><span class="p">,</span><span class="n">correct_background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">correct_H</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">e</span><span class="o">=</span><span class="n">hysteresis_correct</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;Saturation Magnetisation = </span><span class="si">{}</span><span class="s2">+/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;Ms&quot;</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;Ms Error&quot;</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;Coercive Field = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;Hc&quot;</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;Remanance = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;Remenance&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The keyword arguments provide options to turn on or off corrections to remove diamagnetic background (and offset in M),
and any offset in H (e.g. due to trapped flux in the magnetometer). The latter option is slightly dangerous aas it will
also remove the effect of any eexhange bias that moves the coercive field. As well as performing the corrections, the code
will add metadata items for:</p>
<blockquote>
<div><ul class="simple">
<li><p>Background susceptibility (from fitting striaght lines to the out part of the data)</p></li>
<li><p>Saturation magnetisation and uncertainty (also from fitting lines to the out part of the data)</p></li>
<li><p>Coervice Fields (H for zero M)</p></li>
<li><p>Remenance (M for zero H)</p></li>
<li><p>Saturation Fields (H where M deviates by the standard error from saturation)</p></li>
<li><p>Maximum BH product (the point where -H * M is maximum)</p></li>
<li><p>Loop Area (from integrating the area inside the hysteresis loop - only valide for complete loops)</p></li>
</ul>
</div></blockquote>
<p>Some of these parameters are determined by fitting a straight line to the outer portions of the data (i.e. at the
extrema in H). The keyword parameter <em>saturation_fraction</em> controls the extent of the data assumed to be saturated.</p>
</div>
<div class="section" id="formatting-error-values">
<h3>Formatting Error Values<a class="headerlink" href="#formatting-error-values" title="Permalink to this headline">¶</a></h3>
<p>In experimental physics, the usual practice (unless one has good reason to do otherwise) is to quote uncertainties in
a measurement to one signficant figure, and then quote the value to the same number of decimal places. Whilst doing this
might sound simple, actually doing it seems something that many students find difficult. To hep with this task, the <code class="xref py py-mod docutils literal notranslate"><span class="pre">Stoner.Util</span></code> module
provides the <code class="xref py py-func docutils literal notranslate"><span class="pre">Stoner.Util.format_error()</span></code> function.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner.Util</span> <span class="kn">import</span> <span class="n">format_error</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">hbar</span><span class="p">,</span><span class="n">m_e</span><span class="p">,</span><span class="n">m_u</span>
<span class="nb">print</span> <span class="n">format_error</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">format_error</span><span class="p">(</span><span class="n">m_e</span><span class="p">,</span><span class="n">hbar</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">format_error</span><span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="n">m_e</span><span class="p">,</span><span class="n">hbar</span><span class="o">/</span><span class="n">m_u</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;eng&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">format_error</span><span class="p">(</span><span class="n">hbar</span><span class="o">/</span><span class="n">m_e</span><span class="p">,</span><span class="n">hbar</span><span class="o">/</span><span class="n">m_u</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;eng&quot;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;Js rads^{-1}kg^{-1})</span>
</pre></div>
</div>
<p>The simplest form just outputs value+/- error with suitable rounding. Adding the <em>latex</em> keyword argument wraps the output in
$…$ and replaces +/- with the equivalent latex math symbol. The <em>mode</em> argument can be <em>eng</em>,*sci* or <em>float*(default). The first
uses SI prefixes in presenting the number, the second uses mantissa-exponent notation (or x10^{exponent} in latex mode). The third,
default, option does no particular scaling. Finally the units keyword allows the inclusion of the units for the quantity in the string
- particularly useful in combination with the *eng</em> mode.</p>
</div>
</div>
<div class="section" id="fitting-tricks">
<span id="id1"></span><h2>Fitting Tricks<a class="headerlink" href="#fitting-tricks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fitting-3d-data">
<h3>Fitting 3D Data<a class="headerlink" href="#fitting-3d-data" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Analysis.AnalysisMixin.curve_fit()</span></code> can also be used to fit 3D (or higher order) data - i.e. where there are two independent
variables. In order to do this, the <em>xcol</em> parameter needs to be an iterable (e.g. list or tuple or array), and
the function to be fitted needs to take a tuple of scalars or arrays as the first argument. The following example
illustrates this by fitting a plane to a collection of points in 3D space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Use curve_fit to fit a plane to some data.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">normal</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> <span class="n">column_stack</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cmap</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="k">def</span> <span class="nf">plane</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to define a plane.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">-</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="n">coeefs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">plane</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="o">*</span><span class="n">coeefs</span><span class="p">)</span> <span class="o">+</span> <span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span>
    <span class="n">column_stack</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">ravel</span><span class="p">())),</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Fitting a Plane&quot;</span><span class="p">,</span>
    <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">column_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
<span class="n">d</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">)</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">setas</span> <span class="o">=</span> <span class="s2">&quot;xy.z&quot;</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;$z=c-ax+by$</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;plane:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../samples/curvefit_plane2.png">png</a>, <a class="reference external" href="../samples/curvefit_plane2.hires.png">hires.png</a>, <a class="reference external" href="../samples/curvefit_plane2.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/curvefit_plane2.png" src="../_images/curvefit_plane2.png" />
</div>
</div>
<div class="section" id="fitting-to-minimize-a-function">
<h3>Fitting to Minimize a Function<a class="headerlink" href="#fitting-to-minimize-a-function" title="Permalink to this headline">¶</a></h3>
<p>If <em>ycol</em> is a numpy array of the same length as the data then the values of ycol are
assumed to be the points to fit rather than index of a column. This is useful if
the function you want to fit can be written as <span class="math notranslate nohighlight">\(f(x_1,x_2,\cdots ,x_n)=0\)</span>.
In thus case pass <em>xcol</em> a list or tuple of columns that make up <span class="math notranslate nohighlight">\(x_1,x_2,\cdots ,x_n\)</span>
and make your function take a tuple of 1D-arrays and pass <em>ycol</em> as an array of zeros.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Fit a sphere with curve_fit.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">sin</span><span class="p">,</span>
    <span class="n">cos</span><span class="p">,</span>
    <span class="n">pi</span><span class="p">,</span>
    <span class="n">column_stack</span><span class="p">,</span>
    <span class="n">zeros_like</span><span class="p">,</span>
    <span class="n">ones_like</span><span class="p">,</span>
    <span class="n">meshgrid</span><span class="p">,</span>
    <span class="n">linspace</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">normal</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts from spherical to cartesian co-ordinates.&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
<span class="k">def</span> <span class="nf">sphere</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns zero if (x,y,z) lies on a sphere centred at (a,b,c) with radius r.&quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span>
<span class="c1"># Create some points approximately spherical distribution</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">pi</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mf">3.0</span>
<span class="n">y</span> <span class="o">-=</span> <span class="mf">4.0</span>
<span class="n">z</span> <span class="o">+=</span> <span class="mf">2.0</span>
<span class="c1"># Construct the  DataFile object</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span>
    <span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)),</span>
    <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Best fit sphere&quot;</span><span class="p">,</span>
    <span class="n">column_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">fig_width</span> <span class="o">=</span> <span class="mf">5.2</span>
<span class="n">d</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">fig_height</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># Square aspect ratio</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">)</span>
<span class="c1"># curve_fit does the hard work</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">sphere</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
<span class="c1"># This manually constructs the best fit sphere</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">popt</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">P</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">ones_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="n">a</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">b</span>
<span class="n">z</span> <span class="o">+=</span> <span class="n">c</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../samples/curvefit_sphere_2.png">png</a>, <a class="reference external" href="../samples/curvefit_sphere_2.hires.png">hires.png</a>, <a class="reference external" href="../samples/curvefit_sphere_2.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/curvefit_sphere_2.png" src="../_images/curvefit_sphere_2.png" />
</div>
</div>
</div>
<div class="section" id="other-recipies">
<h2>Other Recipies<a class="headerlink" href="#other-recipies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="extract-x-y-z-from-x-y-z-data">
<h3>Extract X-Y(Z) from X-Y-Z data<a class="headerlink" href="#extract-x-y-z-from-x-y-z-data" title="Permalink to this headline">¶</a></h3>
<p>In a number of measurement systems the data is returned as 3 parameters X, Y and
Z and one wishes to extract X-Y as a function of constant Z. For example, <em>I-V</em>
sweeps as a function of gate voltage <em>V:sub:G</em>. Assuming we have a data file with
columns <em>Current</em>, <em>Voltage</em>,*Gate*:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">DataFile</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">=</span><span class="n">d</span>
<span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;Gate&#39;</span><span class="p">):</span>
    <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Gate&#39;</span><span class="p">,</span><span class="n">gate</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;Data Gate=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first line opens the data file containing the <em>I-V(V_G)</em> data. The second
creates a temporary copy of the <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> object - ensuring that we get a copy of
all metadata and column headers. The <strong>for</strong> loop iterates over all unique
values of the data in the gate column and then inside the for loop, searches for
the corresponding <em>I-V</em> data, sets it as the data of the temporary DataFile and
then saves it.</p>
</div>
<div class="section" id="mapping-x-y-z-data-to-z-x-y-data">
<h3>Mapping X-Y-Z data to Z(X,Y) data<a class="headerlink" href="#mapping-x-y-z-data-to-z-x-y-data" title="Permalink to this headline">¶</a></h3>
<p>In a similar fashion to the previous section, where data has been recorded with
fixed values of <em>X</em> and <em>Y</em> eg <em>I</em> measured for fixed <em>V</em> and <em>V_</em>, it can be
useful to map the data to a matrix.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">DataFile</span><span class="p">(</span><span class="s1">&#39;Data,.txt&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">=</span><span class="n">d</span>
<span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;Gate&#39;</span><span class="p">):</span>
   <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="n">d</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Gate&#39;</span><span class="p">,</span><span class="n">gate</span><span class="p">)[:,</span><span class="n">d</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="s1">&#39;Current&#39;</span><span class="p">)]</span>
<span class="n">t</span><span class="o">.</span><span class="n">column_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Bias=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;Voltage&#39;</span><span class="p">)]</span>
<span class="n">t</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;Gate&#39;</span><span class="p">),</span><span class="s1">&#39;Gate Voltage&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The start of the script follows the previous section, however this time in the
for loop the addition operator is used to add a single row to the temporary
<a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stoner.Core.DataFile</span></code></a> <em>t</em>. In this case we are using the utility method
<a class="reference internal" href="../classes/Stoner.Core.DataFile.find_col.html#Stoner.Core.DataFile.find_col" title="Stoner.Core.DataFile.find_col"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.Core.DataFile.find_col()</span></code></a> to find the index of the column with the current
data. After the <strong>for</strong> loop we set the column headers in <em>t</em> and then insert
an additional column at the start with the gate voltage values.</p>
<p>The matrix generated by this code is suitable for feeding directly into
<a class="reference internal" href="../classes/Stoner.plot.PlotMixin.html#Stoner.plot.PlotMixin.plot_matrix" title="Stoner.plot.PlotMixin.plot_matrix"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.plot.PlotMixin.plot_matrix()</span></code></a>, however, the same plot could be generated
directly from the <a class="reference internal" href="../classes/Stoner.plot.PlotMixin.html#Stoner.plot.PlotMixin.plot_xyz" title="Stoner.plot.PlotMixin.plot_xyz"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Stoner.plot.PlotMixin.plot_xyz()</span></code></a> method too.</p>
</div>
<div class="section" id="sampling-a-a-3d-surface-function">
<h3>Sampling a A 3D Surface function<a class="headerlink" href="#sampling-a-a-3d-surface-function" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have a function Z(x,y) that is defined over a range -X0..+X0 and
-Y0..y0 and want to quickly get a view of the surface. This problem can be easily done
by creating a random distribution of (x,y) points, evaluating the function and then
using the <code class="xref py py-class docutils literal notranslate"><span class="pre">PlotFile</span></code> methods to generate the surface.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">uniform</span>

<span class="n">samples</span><span class="o">=</span><span class="mi">5000</span>

<span class="n">surf</span><span class="o">=</span><span class="n">Data</span><span class="p">()</span>
<span class="n">surf</span><span class="o">&amp;=</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">X0</span><span class="p">,</span><span class="n">X0</span><span class="p">,</span><span class="n">samples</span><span class="p">)</span>
<span class="n">surf</span><span class="o">&amp;=</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">Y0</span><span class="p">,</span><span class="n">Y0</span><span class="p">,</span><span class="n">samples</span><span class="p">)</span>
<span class="n">surf</span><span class="o">.</span><span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span>
<span class="n">surf</span><span class="o">&amp;=</span><span class="n">Z</span><span class="p">(</span><span class="n">surf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">surf</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">surf</span><span class="o">.</span><span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span>
<span class="n">surf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c1"># or surf.plot(cstride=1,rstride=1,linewidth=0) for finer detail.</span>
</pre></div>
</div>
</div>
<div class="section" id="quickly-sectioning-a-3d-dataset">
<h3>Quickly Sectioning a 3D dataset<a class="headerlink" href="#quickly-sectioning-a-3d-dataset" title="Permalink to this headline">¶</a></h3>
<p>We often model the magnetic state in our experiments using a variety of micromagnetic
modelling codes, such OOMMF or MuMax. When modelling a 3D system, it is often useful to
be able to examine a cross-section of the simulation. The Stoner package provides tools
to quickly examine the output data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Stoner.FileFormats</span> <span class="kn">import</span> <span class="n">OVFFile</span> <span class="c1"># reads OOMMF vector field files</span>
<span class="kn">import</span> <span class="nn">Stoner.plot</span>
<span class="n">p</span><span class="o">=</span><span class="n">SP</span><span class="o">.</span><span class="n">PlotFile</span><span class="p">(</span><span class="s1">&#39;my_simulation.ovf&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xyzuvw&quot;</span>
<span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mf">10.5</span><span class="p">)</span> <span class="c1"># Take a slice inthe xy plane where z is 10.5 nm</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c1"># A 3D plot with cones</span>
<span class="n">p</span><span class="o">.</span><span class="n">setas</span><span class="o">=</span><span class="s2">&quot;xy.uvw&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c1"># a 2D colour wheel plot with triangular glyphs showing vector direction.</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/StonerLogo2.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cookbook</a><ul>
<li><a class="reference internal" href="#the-util-module">The Util module</a><ul>
<li><a class="reference internal" href="#the-data-class">The <code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code> Class</a></li>
<li><a class="reference internal" href="#splitting-data-into-rising-and-falling-values">Splitting Data into rising and falling values</a></li>
<li><a class="reference internal" href="#analysis-of-hysteresis-loops">Analysis of Hysteresis Loops</a></li>
<li><a class="reference internal" href="#formatting-error-values">Formatting Error Values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fitting-tricks">Fitting Tricks</a><ul>
<li><a class="reference internal" href="#fitting-3d-data">Fitting 3D Data</a></li>
<li><a class="reference internal" href="#fitting-to-minimize-a-function">Fitting to Minimize a Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-recipies">Other Recipies</a><ul>
<li><a class="reference internal" href="#extract-x-y-z-from-x-y-z-data">Extract X-Y(Z) from X-Y-Z data</a></li>
<li><a class="reference internal" href="#mapping-x-y-z-data-to-z-x-y-data">Mapping X-Y-Z data to Z(X,Y) data</a></li>
<li><a class="reference internal" href="#sampling-a-a-3d-surface-function">Sampling a A 3D Surface function</a></li>
<li><a class="reference internal" href="#quickly-sectioning-a-3d-dataset">Quickly Sectioning a 3D dataset</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="image.html"
                        title="previous chapter">Working with Images</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="upgrade.html"
                        title="next chapter">ConvertingScripts from Older Versions of the Stoner Package</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/UserGuide/cookbook.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form class="search" action="../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="image.html" title="Previous document">Working with Images</a>
        </li>
        <li>
          <a href="upgrade.html" title="Next document">ConvertingScripts from Older Versions of the Stoner Package</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Stoner Package</a></li>
      <li>
        <a href="ugindex.html">The Stoner Python Package User Guide</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2013-15, Gavin Burnell et al.Last updated on Dec 02, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      3.2.1
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>