<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developer’s Guide &mdash; Stoner Pacakge API Documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Stoner Pacakge API Documentation" href="../index.html" />
    <link rel="up" title="The Stoner Python Package User Guide" href="ugindex.html" />
    <link rel="next" title="Contributors and Credits" href="credits.html" />
    <link rel="prev" title="Cookbook" href="cookbook.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="credits.html" title="Contributors and Credits"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cookbook.html" title="Cookbook"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Stoner Package</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="ugindex.html" accesskey="U">The Stoner Python Package User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="developer-s-guide">
<h1>Developer&#8217;s Guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this headline">¶</a></h1>
<p>This section provides some notes and guidance on extending the Stoner Package.</p>
<div class="section" id="understanding-the-class-structure">
<h2>Understanding the Class Structure<a class="headerlink" href="#understanding-the-class-structure" title="Permalink to this headline">¶</a></h2>
<p>The Stoner Package makes use of several classes to handle representing experimental data that are hidden away from the casual user of the package.
From the end-user perspective, the <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal"><span class="pre">DataFile</span></code></a> class contains several attributes that behave like data types that the user is familiar with:</p>
<ul class="simple">
<li>data
Although this is essentially a numpy array, it is in fact a subclass of a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/maskedarray.baseclass.html#numpy.ma.MaskedArray" title="(in NumPy v1.10)"><code class="xref py py-class docutils literal"><span class="pre">numpy.ma.MaskedArray</span></code></a>, <a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray" title="Stoner.Core.DataArray"><code class="xref py py-class docutils literal"><span class="pre">DataArray</span></code></a>, with an extra attribute
<a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray.setas" title="Stoner.Core.DataArray.setas"><code class="xref py py-attr docutils literal"><span class="pre">DataArray.setas</span></code></a> that is used to label the columns of data and to track assignments to types of columns (x,y,z etc). As
<a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray" title="Stoner.Core.DataArray"><code class="xref py py-class docutils literal"><span class="pre">DataArray</span></code></a> can thus track what columns mean in cartersian co-ordinate systems, it can provide an on-the-fly conversion to polar
co-ordinate sustems. <a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray" title="Stoner.Core.DataArray"><code class="xref py py-class docutils literal"><span class="pre">DataArray</span></code></a> also keeps track of the row numbers of the array and can label its rows with the <a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray.i" title="Stoner.Core.DataArray.i"><code class="xref py py-attr docutils literal"><span class="pre">DataArray.i</span></code></a>
attribute.</li>
<li>metadata
In many respects this looks like a standard dictionary, albeit one that sorts its keys in alpahabetical order. Actually it is a subclass of a
blist.sortedDict that maintains a second dictionary with matching keys that stores information about the data type of the values in the metadata
in order to support export to non-duck typed environments.</li>
<li>column_headers
This appears to be a stadnard list of strings, except that it is kept in sync with the size of the numerical data array, adding extra entries or
losing them as the data array gains or loses columns. Actually this is proxied through to the <a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray.setas" title="Stoner.Core.DataArray.setas"><code class="xref py py-attr docutils literal"><span class="pre">DataArray.setas</span></code></a> attribute</li>
<li>setas
This is a simple proxy through to the <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile.data" title="Stoner.Core.DataFile.data"><code class="xref py py-attr docutils literal"><span class="pre">DataFile.data</span></code></a> attribute&#8217;s <a class="reference internal" href="../classes/Stoner.Core.DataArray.html#Stoner.Core.DataArray.setas" title="Stoner.Core.DataArray.setas"><code class="xref py py-attr docutils literal"><span class="pre">DataArray.setas</span></code></a> attribute. As described above, this provides
the column labelling and assignment functionality, it also handles the code to index columns by number, name, regular expression pattern. Internally
this attribute stores a simple list of the column assignments, but supports being called with a variety of arguments and keyword arguments to manipulate
that list. Attempting to set this attribute results in a translation to the appropriate function call, whilst getting it is converted to expressing it
as a list. The attribute also supports both dictionary like and list like get and set item calls to access elements by index, or indices by assignment.</li>
</ul>
<div class="figure" id="id1">
<img src="../_images/class_heirarchy.svg" /><p class="caption"><span class="caption-text">The relationships between the various classes that make up the <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal"><span class="pre">DataFile</span></code></a> structure. The dashed arrows represent proxy attributes, solid
arrows represent direct attributes. The arrow labels indicate the attribute names, whilst the labels in the boxes are the class names.</span></p>
</div>
</div>
<div class="section" id="adding-new-data-file-types">
<h2>Adding New Data File Types<a class="headerlink" href="#adding-new-data-file-types" title="Permalink to this headline">¶</a></h2>
<p>The first question to ask is whether the data file format that you are working with is one that others in the group will be interested in using.
If so, then the best thing would be to include it in the <a class="reference internal" href="../Stoner.html#module-Stoner.FileFormats" title="Stoner.FileFormats"><code class="xref py py-mod docutils literal"><span class="pre">Stoner.FileFormats</span></code></a> module in the package, otherwise you should just write
the class in your own script files. In either case, develop the class in your own script files first.</p>
<p>The best way to implement handling a new data format is to write a new subclass of <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal"><span class="pre">DataFile</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NewInstrumentFile</span><span class="p">(</span><span class="n">DataFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extends DataFile to load files from somewhere else</span>

<span class="sd">    Written by Gavin Burnell 11/3/2012&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>A document string should be provided that will help the user identify the function of the new class (and avoid using names that might be commonly replicated !).
Only one method needs to be implemented: a new <a class="reference internal" href="../classes/Stoner.Core.DataFile._load.html#Stoner.Core.DataFile._load" title="Stoner.Core.DataFile._load"><code class="xref py py-meth docutils literal"><span class="pre">DataFile._load()</span></code></a> method. Ththis should have the following structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just call the parent class but with the right parameters set&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</pre></div>
</div>
<p>then follows the code to actually read the file. It <strong>must</strong> at the very least provide a column header for
every column of data and read in as much numeric data as possible and it <strong>should</strong> read as
much of the meta data as possible. The function terminates by returning a copy of the current object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>One useful function for reading metadata from files is <a class="reference internal" href="../classes/Stoner.Core.typeHintedDict.string_to_type.html#Stoner.Core.typeHintedDict.string_to_type" title="Stoner.Core.typeHintedDict.string_to_type"><code class="xref py py-meth docutils literal"><span class="pre">typeHintedDict.string_to_type()</span></code></a> which will try to convert a
string representation of data into a sensible Python type.</p>
<p>There are two class attributes, <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile.priority" title="Stoner.Core.DataFile.priority"><code class="xref py py-attr docutils literal"><span class="pre">DataFile.priority</span></code></a> that can be used to tweak the automatic file
importing code.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">32</span>
</pre></div>
</div>
<p>When the subclasses are tried to see if they can load an undetermined file, they are tried in order of
priority. If your load code can make a positive determination that it has the correct file
(eg by looking for some magic combination of characters at the start of the file) and can throw an
exception if it tries loading an incorrect file, then you can give it a lower priority number to
force it to run earlier. Conversely if your only way of identifying your own files is seeing they make
sense when you try to load them and that you might partially succeed with a file from another system (as
can happen if you have a tab or comma separated text file), then you should raise the priority number.
Currently Lpy:class:<cite>DataFile</cite> defaults to 32, <a class="reference internal" href="../classes/Stoner.FileFormats.CSVFile.html#Stoner.FileFormats.CSVFile" title="Stoner.FileFormats.CSVFile"><code class="xref py py-class docutils literal"><span class="pre">Stoner.FileFormats.CSVFile</span></code></a> and
<a class="reference internal" href="../classes/Stoner.FileFormats.BigBlueFile.html#Stoner.FileFormats.BigBlueFile" title="Stoner.FileFormats.BigBlueFile"><code class="xref py py-class docutils literal"><span class="pre">Stoner.FileFormats.BigBlueFile</span></code></a> have values of 128 and 64 respectively.</p>
<p>THe other attribute one might add is <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile.patterns" title="Stoner.Core.DataFile.patterns"><code class="xref py py-attr docutils literal"><span class="pre">DataFile.patterns</span></code></a> which is a list of filename extension glob patterns that
will match the expected filenames for this format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;*.txt&quot;</span><span class="p">,</span><span class="s">&quot;*/dat&quot;</span><span class="p">,</span><span class="s">&quot;*/qda&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Any custome data class <strong>should</strong> try to identify if the file is the correct format and if so it <strong>must</strong> raise a
<a class="reference internal" href="../classes/Stoner.Core.StonerLoadError.html#Stoner.Core.StonerLoadError" title="Stoner.Core.StonerLoadError"><code class="xref py py-class docutils literal"><span class="pre">StonerLoadError</span></code></a> exception in order that the autoloading code will known to try a different subclass of <a class="reference internal" href="../classes/Stoner.Core.DataFile.html#Stoner.Core.DataFile" title="Stoner.Core.DataFile"><code class="xref py py-class docutils literal"><span class="pre">DataFile</span></code></a>.</p>
<p>If you need to write any additional methods please make sure that they have Google code-style document
strings so that the API documentation is picked up correctly.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/StonerLogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Developer&#8217;s Guide</a><ul>
<li><a class="reference internal" href="#understanding-the-class-structure">Understanding the Class Structure</a></li>
<li><a class="reference internal" href="#adding-new-data-file-types">Adding New Data File Types</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cookbook.html"
                        title="previous chapter">Cookbook</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="credits.html"
                        title="next chapter">Contributors and Credits</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/UserGuide/developer.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="credits.html" title="Contributors and Credits"
             >next</a> |</li>
        <li class="right" >
          <a href="cookbook.html" title="Cookbook"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Stoner Package</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="ugindex.html" >The Stoner Python Package User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013-15, Gavin Burnell et al.
      Last updated on Dec 16, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>