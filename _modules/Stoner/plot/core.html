
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Stoner.plot.core &#8212; Stoner Pacakge API Documentation</title>
    <link rel="stylesheet" href="../../../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../../../index.html ">
        Stoner Pacakge API Documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Stoner Package</a></li>
      <li>
        <a href="../../index.html">Module code</a>
      </li>
      <li>
        <a href="../../Stoner.html">Stoner</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Stoner.plot.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Stoner.plot Subpackage</span>
<span class="sd">======================</span>

<span class="sd">Provides the a class to facilitate easier plotting of Stoner Data:</span>

<span class="sd">Classes:</span>
<span class="sd">    PlotMixin - A class that uses matplotlib to plot data</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PlotMixin&quot;</span><span class="p">,</span> <span class="s2">&quot;hsl2rgb&quot;</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">Stoner.compat</span> <span class="k">import</span> <span class="n">python_v3</span><span class="p">,</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">index_types</span><span class="p">,</span> <span class="n">int_types</span>
<span class="kn">from</span> <span class="nn">Stoner.tools</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">_attribute_store</span><span class="p">,</span>
    <span class="n">isNone</span><span class="p">,</span>
    <span class="n">isAnyNone</span><span class="p">,</span>
    <span class="n">all_type</span><span class="p">,</span>
    <span class="n">isiterable</span><span class="p">,</span>
    <span class="n">typedList</span><span class="p">,</span>
    <span class="n">get_option</span><span class="p">,</span>
    <span class="n">fix_signature</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.formats</span> <span class="k">import</span> <span class="n">DefaultPlotStyle</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">errorfill</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np_</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">colorsys</span> <span class="k">import</span> <span class="n">hls_to_rgb</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;posix&quot;</span> <span class="ow">and</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>

    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;MacOSX&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">figure</span> <span class="k">as</span> <span class="n">mplfig</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">cm</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># Check we&#39;ve got 3D plotting</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">host_subplot</span><span class="p">,</span> <span class="n">inset_locator</span>
    <span class="kn">import</span> <span class="nn">mpl_toolkits.axisartist</span> <span class="k">as</span> <span class="nn">AA</span>

    <span class="n">_3D</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_3D</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">python_v3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getfullargspec</span>

    <span class="n">getargspec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getargspec</span>


<div class="viewcode-block" id="PlotMixin"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin">[docs]</a><span class="k">class</span> <span class="nc">PlotMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A mixin class that works with :py:class:`Stoner.Core.DataFile` to add additional plotting functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            args(tuple): Arguements to pass to :py:meth:`Stoner.Core.DataFile.__init__`</span>
<span class="sd">            kargs (dict):  keyword arguments to pass to \b DataFile.__init__</span>

<span class="sd">        Attributes:</span>
<span class="sd">            ax (matplotlib.Axes): The current axes on the current figure.</span>
<span class="sd">            axes (list of matplotlib.Axes): A list of all the axes on the current figure</span>
<span class="sd">            fig (matplotlib.figure): The current figure object being worked with</span>
<span class="sd">            fignum (int): The current figure&#39;s number.</span>
<span class="sd">            labels (list of string): List of axis labels as aternates to the column_headers</span>
<span class="sd">            showfig (bool or None): Controls whether plot functions return a copy of the figure (True), the DataFile (False) or Nothing (None)</span>
<span class="sd">            subplots (list of matplotlib.Axes) - essentially the same as :py:attr:`PlotMixin.axes` but ensures that the list of subplots is synchronised to the number fo Axes.</span>
<span class="sd">            template (:py:class:`Sonter.plot.formats.DefaultPlotStyle` or instance): A plot style template subclass or object that determines the format and appearance of plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">positional_fmt</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">]</span>
    <span class="n">no_fmt</span> <span class="o">=</span> <span class="p">[</span><span class="n">errorfill</span><span class="p">]</span>
    <span class="n">_template</span> <span class="o">=</span> <span class="n">DefaultPlotStyle</span><span class="p">()</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">multiple</span> <span class="o">=</span> <span class="s2">&quot;common&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>  <span class="c1"># Do the import of plt here to speed module load</span>
        <span class="sd">&quot;&quot;&quot;Constructor of \b PlotMixin class. Imports plt and then calls the parent constructor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showfig</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;showfig&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># Retains previous behaviour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_public_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">),</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">DefaultPlotStyle</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">DefaultPlotStyle</span><span class="p">)),</span>
            <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="s2">&quot;ylim&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">string_types</span><span class="p">,</span>
            <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="n">string_types</span><span class="p">,</span>
            <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="n">string_types</span><span class="p">,</span>
            <span class="s2">&quot;_showfig&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="n">typedList</span><span class="p">(</span><span class="n">string_types</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done PlotMixin init&quot;</span><span class="p">)</span>

    <span class="c1"># ============================================================================================================================</span>
    <span class="c1"># Properties of PlotMixin</span>
    <span class="c1"># ============================================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current axis number.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

    <span class="nd">@ax</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the current axis number.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Figure doesn&#39;t have enough axes&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return  the current axes object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>

    <span class="nd">@cmap</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the current figure.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>

    <span class="nd">@fig</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the current figure.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;fig should be a number of matplotlib figure&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fignum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current figure number.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">number</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the labels for the plot columns&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">)</span> <span class="p">:]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span>

    <span class="nd">@labels</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the labels for the plot columns.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="n">typedList</span><span class="p">(</span><span class="n">string_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">all_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="n">typedList</span><span class="p">(</span><span class="n">string_types</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;labels should be iterable and all strings, or None, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">showfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns either the current figure or self or None, depeding on whether the attribute is True or False or None.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showfig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;no_figs&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showfig</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@showfig</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">showfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force a figure to be displayed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;showfig should be a boolean value not a </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_showfig</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subplots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the subplot instances.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current plot template.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_template&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">DefaultPlotStyle</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span>

    <span class="nd">@template</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the current template.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DefaultPlotStyle</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DefaultPlotStyle</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Template is not of the right class:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unmask the underlying attribute so we can fiddle plots.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax_title</span>

    <span class="nd">@title</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the plot title as well as setting the parent title value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_title</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_Plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method for plotting a single plot to a figure.</span>

<span class="sd">        Args:</span>
<span class="sd">            ix (int): COlumn index of x data</span>
<span class="sd">            iy (int): Column index of y data</span>
<span class="sd">            fmt (str): Format of this plot</span>
<span class="sd">            plotter (callable): Routine used to plot this data</span>
<span class="sd">            figure (matplotlib.figure): Figure to plot data</span>
<span class="sd">            **kwords (dict): Other keyword arguments to pass through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwords</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">kwords</span><span class="p">)</span>  <span class="c1"># Make sure we don;t mutate kwords by accident</span>
        <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwords</span><span class="p">:</span>
            <span class="n">kwords</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mask</span> <span class="o">|</span> <span class="n">y</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positional_fmt</span><span class="p">:</span>  <span class="c1"># plots with positional fmt</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_fmt</span><span class="p">:</span>
            <span class="n">plotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwords</span><span class="p">[</span><span class="s2">&quot;fmt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="n">plotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">customise_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__SurfPlotter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility private function to plot a 3D color mapped surface.</span>

<span class="sd">        Args:</span>
<span class="sd">            X data</span>
<span class="sd">            Y Y data</span>
<span class="sd">            Z data</span>
<span class="sd">            kargs (dict): Other keywords to pass through</span>

<span class="sd">        ReturnsL</span>
<span class="sd">            A matplotib Figure</span>

<span class="sd">        This function attempts to work the same as the 2D surface plotter pcolor, but draws a 3D axes set&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_3D</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;3D plotting Not available. Install matplotlib toolkits&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">surf</span>

    <span class="k">def</span> <span class="nf">__mpl3DQuiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function to plot vector fields using mpltoolkit.quiver.</span>

<span class="sd">        Args:</span>
<span class="sd">            X (array): X data co-ordinates</span>
<span class="sd">            Y (array): Y data co-ordinates</span>
<span class="sd">            Z (array): Z data co-ordinates</span>
<span class="sd">            U (array): U data vector field component</span>
<span class="sd">            V (array): V data vector field component</span>
<span class="sd">            W (array): W data vector field component</span>

<span class="sd">        Return:</span>
<span class="sd">            matpltolib.pyplot.figure with a quiver plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_3D</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;3D plotting Not available. Install matplotlib toolkits&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">))</span>
        <span class="n">vector_field</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vector_field</span>

    <span class="k">def</span> <span class="nf">_vector_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Map a vector direction in the data to a value for use with a colormnap.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="n">ucol</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="n">vcol</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="n">wcol</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">wcol</span><span class="p">,</span> <span class="n">index_types</span><span class="p">):</span>  <span class="c1"># 3D vector field</span>
            <span class="n">wdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">wcol</span><span class="p">)</span>
            <span class="n">phidata</span> <span class="o">=</span> <span class="p">(</span><span class="n">wdata</span> <span class="o">-</span> <span class="n">_np_</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wdata</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">wdata</span><span class="p">)</span> <span class="o">-</span> <span class="n">_np_</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wdata</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># 2D vector field</span>
            <span class="n">phidata</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">wdata</span> <span class="o">=</span> <span class="n">phidata</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">qdata</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ucol</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">vcol</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np_</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rdata</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ucol</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">vcol</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">wdata</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">rdata</span> <span class="o">=</span> <span class="n">rdata</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">hsl2rgb</span><span class="p">(</span><span class="n">qdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">phidata</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="k">return</span> <span class="n">Z</span>

    <span class="k">def</span> <span class="nf">_span_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a slice that covers the range of a given column.&quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">_np_</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">int_types</span><span class="p">):</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">delta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_VectorFieldPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function to plot vector fields using mayavi.mlab.</span>

<span class="sd">        Args:</span>
<span class="sd">            X (array): X data co-ordinates</span>
<span class="sd">            Y (array): Y data co-ordinates</span>
<span class="sd">            Z (array): Z data co-ordinates</span>
<span class="sd">            U (array): U data vector field component</span>
<span class="sd">            V (array): V data vector field component</span>
<span class="sd">            W (array): W data vector field component</span>

<span class="sd">        Returns:</span>
<span class="sd">            An mlab figure reference.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span>  <span class="c1"># might not work !</span>
            <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="k">import</span> <span class="n">tvtk</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;scalars&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
            <span class="n">col_mode</span> <span class="o">=</span> <span class="s2">&quot;color_by_scalar&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_mode</span> <span class="o">=</span> <span class="s2">&quot;color_by_vector&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;scalars&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]:</span>  <span class="c1"># fancy mode on</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_color</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">colors</span><span class="p">,</span> <span class="n">_np_</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">quiver3d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="n">quiv</span><span class="o">.</span><span class="n">glyph</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">col_mode</span>
            <span class="n">quiv</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">scalar_lut_manager</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">quiver3d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="n">quiv</span><span class="o">.</span><span class="n">glyph</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">col_mode</span>
        <span class="k">return</span> <span class="n">quiv</span>

    <span class="k">def</span> <span class="nf">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up a column and see if it exists in self._lables, otherwise get from self.column_headers.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (column index type): Column to return label for</span>

<span class="sd">        Returns:</span>
<span class="sd">            String type representing the column label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">join</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ix</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ix</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles the local attributes as well as the inherited ones.&quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">attr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
        <span class="n">attr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">attr</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;fig&quot;</span><span class="p">,</span> <span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;subplots&quot;</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">])</span>
        <span class="n">attr</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;xlim&quot;</span><span class="p">,</span> <span class="s2">&quot;ylim&quot;</span><span class="p">))</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fix_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sorts out axis specs, replacing with contents from setas as necessary.&quot;&quot;&quot;</span>
        <span class="n">startx</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;startx&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setas</span><span class="o">.</span><span class="n">_get_cols</span><span class="p">(</span><span class="n">startx</span><span class="o">=</span><span class="n">startx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="s2">&quot;xcol&quot;</span><span class="p">,</span> <span class="s2">&quot;xerr&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ycol&quot;</span><span class="p">,</span> <span class="s2">&quot;zcol&quot;</span><span class="p">,</span> <span class="s2">&quot;ucol&quot;</span><span class="p">,</span> <span class="s2">&quot;vcol&quot;</span><span class="p">,</span> <span class="s2">&quot;wcol&quot;</span><span class="p">,</span> <span class="s2">&quot;yerr&quot;</span><span class="p">,</span> <span class="s2">&quot;zerr&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;multi_y&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xcol&quot;</span><span class="p">,</span> <span class="s2">&quot;ycol&quot;</span><span class="p">,</span> <span class="s2">&quot;zcol&quot;</span><span class="p">,</span> <span class="s2">&quot;ucol&quot;</span><span class="p">,</span> <span class="s2">&quot;vcol&quot;</span><span class="p">,</span> <span class="s2">&quot;wcol&quot;</span><span class="p">,</span> <span class="s2">&quot;xerr&quot;</span><span class="p">,</span> <span class="s2">&quot;yerr&quot;</span><span class="p">,</span> <span class="s2">&quot;zerr&quot;</span><span class="p">]:</span>
                <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_attribute_store</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fix_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sorts out the matplotlib figure handling.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">_fix_kargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">otherkargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fix parameters to the plotting function to provide defaults and no extransous arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dictionary of correct arguments, dictionary of all arguments,dictionary of keyword arguments&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>

        <span class="n">fig_kargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="s2">&quot;facecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;edgecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;frameon&quot;</span><span class="p">,</span> <span class="s2">&quot;FigureClass&quot;</span><span class="p">,</span> <span class="s2">&quot;clear&quot;</span><span class="p">,</span> <span class="s2">&quot;ax&quot;</span><span class="p">]</span>

        <span class="n">pass_fig_kargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fig_kargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
                <span class="n">pass_fig_kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">otherkargs</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># Defaults now a dictionary of default arugments overlaid with keyword argument values</span>
        <span class="c1"># Now inspect the plotting function to see what it takes.</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;projection&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
                    <span class="n">projection</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;projection&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">projection</span> <span class="o">=</span> <span class="s2">&quot;rectilinear&quot;</span>
                <span class="n">function</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">():</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">())</span>

        <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">vargs</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">defs</span><span class="p">)</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="c1"># Manually overide the list of arguments that the plotting function takes if it takes keyword dictionary</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otherkargs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">otherkargs</span><span class="p">)</span>
        <span class="n">nonkargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">nonkargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">pass_fig_kargs</span>

    <span class="k">def</span> <span class="nf">_fix_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">multiple</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Does the titling and labelling for a matplotlib plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">multiple</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;show_plot&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;show_plot&quot;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;save_filename&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;save_filename&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;save_filename&quot;</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attribute accessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (string):  Name of attribute the following attributes are supported:</span>
<span class="sd">                * fig - the current plt figure reference</span>
<span class="sd">                * axes - the plt axes object for the current plot</span>
<span class="sd">                * xlim - the X axis limits</span>
<span class="sd">                * ylim - the Y axis limits</span>

<span class="sd">                All other attrbiutes are passed over to the parent class</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">o_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;plt_&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;pyplot&quot;</span><span class="p">)),</span>  <span class="c1"># Need to be explicit in 2.7!</span>
                <span class="p">(</span><span class="s2">&quot;ax_&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="s2">&quot;axes&quot;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;fig_&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># First look for a function in the pyplot package</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">o_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">o_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">else</span> <span class="n">o_name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyplot_proxy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1"># Nowcheck for prefixed access on axes and figures with get_</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ax_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">:</span>
            <span class="n">tfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">tfig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># protect the current axes and figure</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># oops we need a figure first!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fig_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">:</span>
            <span class="n">tfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">tfig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># protect the current axes and figure</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># oops we need a figure first!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;get_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Ok Fallback to lookinf again at parent class</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">o_name</span><span class="p">)</span>

        <span class="c1"># If we&#39;re still here then we&#39;re calling a proxy from that figure or axes</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tfig</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">tax</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_pyplot_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">,</span> <span class="s2">&quot;pyplot&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;pyplot proxy can&#39;t figure out what to get proxy from.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">what</span> <span class="o">==</span> <span class="s2">&quot;pyplot&quot;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">plt</span>
        <span class="k">elif</span> <span class="n">what</span> <span class="o">==</span> <span class="s2">&quot;figure&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>
        <span class="k">elif</span> <span class="n">what</span> <span class="o">==</span> <span class="s2">&quot;axes&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Attempting to manipulate the methods on a figure or axes before a figure has been created for this Data.&quot;</span>
            <span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>  <span class="c1"># Bug out if this isn&#39;t a callable proxy!</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_proxy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">return</span> <span class="n">fix_signature</span><span class="p">(</span><span class="n">_proxy</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the specified attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (string): The name of the attribute to set. The cuirrent attributes are supported:</span>
<span class="sd">                * fig - set the plt figure isntance to use</span>
<span class="sd">                * xlabel - set the X axis label text</span>
<span class="sd">                * ylabel - set the Y axis label text</span>
<span class="sd">                * title - set the plot title</span>
<span class="sd">                * subtitle - set the plot subtitle</span>
<span class="sd">                * xlim - set the x-axis limits</span>
<span class="sd">                * ylim - set the y-axis limits</span>

<span class="sd">            Only &quot;fig&quot; is supported in this class - everything else drops through to the parent class</span>
<span class="sd">            value (any): The value of the attribute to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">o_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ax_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">:</span>
            <span class="n">tfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">tfig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># protect the current axes and figure</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># oops we need a figure first!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fig_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">:</span>
            <span class="n">tfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">tfig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># protect the current axes and figure</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># oops we need a figure first!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;set_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">o_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">o_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Unable to set attribute </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
            <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tfig</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">tax</span><span class="p">)</span>

<div class="viewcode-block" id="PlotMixin.add_column"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.add_column">[docs]</a>    <span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends a column of data or inserts a column to a datafile instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            column_data (:py:class:`numpy.array` or list or callable): Data to append or insert or a callable function that will generate new data</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            column_header (string): The text to set the column header to,</span>
<span class="sd">                if not supplied then defaults to &#39;col#&#39;</span>
<span class="sd">            index (int or string): The  index (numeric or string) to insert (or replace) the data</span>
<span class="sd">            func_args (dict): If column_data is a callable object, then this argument</span>
<span class="sd">                can be used to supply a dictionary of function arguments to the callable object.</span>
<span class="sd">            replace (bool): Replace the data or insert the data (default)</span>
<span class="sd">            setas (str): Set the type of column (x,y,z data etc - see :py:attr:`Stoner.Core.DataFile.setas`)</span>


<span class="sd">        Returns:</span>
<span class="sd">            A :py:class:`DataFile` instance with the additonal column inserted.</span>

<span class="sd">        Note:</span>
<span class="sd">            Like most :py:class:`DataFile` methods, this method operates in-place in that it also modifies</span>
<span class="sd">            the original DataFile Instance as well as returning it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call the parent method and then update this label</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">column_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="c1"># Mostly this is duplicating the parent method</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PlotMixin.colormap_xyz"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.colormap_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">colormap_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An xyz plot that forces the use of plt.contour.</span>

<span class="sd">        Args:</span>
<span class="sd">            xcol (index): Xcolumn index or label</span>
<span class="sd">            ycol (index): Y column index or label</span>
<span class="sd">            zcol (index): Z column index or label</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            shape (two-tuple): Number of points along x and y in the grid - defaults to a square of sidelength = square root of the length of the data.</span>
<span class="sd">            xlim (tuple): The xlimits, defaults to automatically determined from data</span>
<span class="sd">            ylim (tuple): The ylimits, defaults to automatically determined from data</span>
<span class="sd">            plotter (function): Function to use to plot data. Defaults to plt.contour</span>
<span class="sd">            colorbar (bool): Draw the z-scale color bar beside the plot (True by default)</span>
<span class="sd">            show_plot (bool): Turn on interfactive plotting and show plot when drawn</span>
<span class="sd">            save_filename (string or None): If set to a string, save the plot with this filename</span>
<span class="sd">            figure (integer or matplotlib.figure or boolean): Controls which figure is used for the plot, or if a new figure is opened.</span>
<span class="sd">            **kargs (dict): Other arguments are passed on to the plotter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib figure</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotter&quot;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">)</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;projection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="s2">&quot;rectilinear&quot;</span><span class="p">)</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xlim&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ylim&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;colorbar&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="PlotMixin.contour_xyz"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.contour_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">contour_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An xyz plot that forces the use of plt.contour.</span>

<span class="sd">        Args:</span>
<span class="sd">            xcol (index): Xcolumn index or label</span>
<span class="sd">            ycol (index): Y column index or label</span>
<span class="sd">            zcol (index): Z column index or label</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            shape (two-tuple): Number of points along x and y in the grid - defaults to a square of sidelength = square root of the length of the data.</span>
<span class="sd">            xlim (tuple): The xlimits, defaults to automatically determined from data</span>
<span class="sd">            ylim (tuple): The ylimits, defaults to automatically determined from data</span>
<span class="sd">            plotter (function): Function to use to plot data. Defaults to plt.contour</span>
<span class="sd">            show_plot (bool): Turn on interfactive plotting and show plot when drawn</span>
<span class="sd">            save_filename (string or None): If set to a string, save the plot with this filename</span>
<span class="sd">            figure (integer or matplotlib.figure or boolean): Controls which figure is used for the plot, or if a new figure is opened.</span>
<span class="sd">            **kargs (dict): Other arguments are passed on to the plotter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib figure</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotter</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotMixin.figure"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.figure">[docs]</a>    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;rectilinear&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the figure used by :py:class:`Stoner.plot.PlotMixin`.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure A matplotlib figure or figure number</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current \b Stoner.plot.PlotMixin instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PlotMixin.griddata"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.griddata">[docs]</a>    <span class="k">def</span> <span class="nf">griddata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to convert xyz data onto a regular grid.</span>

<span class="sd">            Args:</span>
<span class="sd">            xcol (index): Column to be used for the X-Data</span>
<span class="sd">            ycol (index): column to be used for Y-Data - default value is column to the right of the x-data column</span>
<span class="sd">            zcol (index): column to be used for the Z-data - default value is the column to the right of the y-data column</span>

<span class="sd">            Keyword Arguments:</span>
<span class="sd">                shape (two-tuple): Number of points along x and y in the grid - defaults to a square of sidelength = square root of the length of the data.</span>
<span class="sd">                xlim (tuple): The xlimits</span>
<span class="sd">                ylim (tuple) The ylimits</span>
<span class="sd">                method (string): Type of interploation to use, default is linear</span>

<span class="sd">            ReturnsL</span>
<span class="sd">                X,Y,Z three two dimensional arrays of the co-ordinates of the interpolated data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">isAnyNone</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;_startx&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
                <span class="n">startx</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;_startx&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;_startx&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">startx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setas</span><span class="o">.</span><span class="n">_get_cols</span><span class="p">(</span><span class="n">startx</span><span class="o">=</span><span class="n">startx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xcol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xcol&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ycol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ycol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;ycol&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">zcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="s2">&quot;zcol&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">zcol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;zcol&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))),</span> <span class="n">_np_</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_slice</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">xlim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">xlim</span><span class="p">))</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;X limit specification not good.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_slice</span><span class="p">(</span><span class="n">ycol</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ylim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">))</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Y limit specification not good.&quot;</span><span class="p">)</span>

        <span class="n">np</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xcol</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">ycol</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">zcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zdata</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zcol</span><span class="p">,</span> <span class="n">_np_</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zcol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># zcol is some data</span>
            <span class="n">zdata</span> <span class="o">=</span> <span class="n">zcol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">zcol</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">Z</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">zdata</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Z</span></div>

<div class="viewcode-block" id="PlotMixin.image_plot"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.image_plot">[docs]</a>    <span class="k">def</span> <span class="nf">image_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Grid up the three columns of data and plot.</span>

<span class="sd">        Args:</span>
<span class="sd">            xcol (index): Column to be used for the X-Data</span>
<span class="sd">            ycol (index): column to be used for Y-Data - default value is column to the right of the x-data column</span>
<span class="sd">            zcol (index): column to be used for the Z-data - default value is the column to the right of the y-data column</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            shape (two-tuple): Number of points along x and y in the grid - defaults to a square of sidelength = square root of the length of the data.</span>
<span class="sd">            xlim (tuple): The xlimits, defaults to automatically determined from data</span>
<span class="sd">            ylim (tuple): The ylimits, defaults to automatically determined from data</span>
<span class="sd">            xlabel (string) X axes label. Deafult is None - guess from xvals or metadata</span>
<span class="sd">            ylabel (string): Y axes label, Default is None - guess from metadata</span>
<span class="sd">            zlabel (string): Z axis label, Default is None - guess from metadata</span>
<span class="sd">            plotter (function): Function to use to plot data. Defaults to plt.contour</span>
<span class="sd">            show_plot (bool): Turn on interfactive plotting and show plot when drawn</span>
<span class="sd">            save_filename (string or None): If set to a string, save the plot with this filename</span>
<span class="sd">            figure (integer or matplotlib.figure or boolean): Controls which figure is used for the plot, or if a new figure is opened.</span>
<span class="sd">            **kargs (dict): Other arguments are passed on to the plotter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib figure</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span>
            <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span> <span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
            <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
            <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">xcol</span><span class="p">)),</span>
            <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">ycol</span><span class="p">)),</span>
        <span class="p">}</span>
        <span class="n">kargs</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_kargs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;cmap&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s2">&quot;cmap&quot;</span> <span class="ow">in</span> <span class="n">nonkargs</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Z Data has a bad shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_titles</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">nonkargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="PlotMixin.inset"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.inset">[docs]</a>    <span class="k">def</span> <span class="nf">inset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new set of axes as an inset to the current plot.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            parent (matplotlib axes): Which set of axes to add inset to, defaults to the current set</span>
<span class="sd">            loc (int or string): Inset location - can be a string like *top right* or *upper right* or a number.</span>
<span class="sd">            width,height (int,float or string) the dimensions of the inset specified as a integer %, or floating point fraction of the parent axes, or as a string measurement.</span>
<span class="sd">            kargs (dictionary): all other keywords are passed through to inset_locator.inset_axes</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new set of axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;best&quot;</span><span class="p">,</span>
            <span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;center left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;center right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
            <span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
            <span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">locations2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;best&quot;</span><span class="p">,</span>
            <span class="s2">&quot;top right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;top left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bottom left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bottom right&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outside&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leftside&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rightside&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="s2">&quot;top&quot;</span><span class="p">,</span>
            <span class="s2">&quot;middle&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">locations</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations2</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">locations2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t work out where </span><span class="si">{}</span><span class="s2"> was supposed to be&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;didn&#39;t Recognize width specification </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;didn&#39;t Recognize width specification </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">inset_locator</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotMixin.plot"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to make an appropriate plot based on the defined column assignments.</span>

<span class="sd">        The column assignments are examined to determine whether to plot and x,y plot or an x,y,z plot</span>
<span class="sd">        and whether to plot error bars (for an x,y plot). All keyword argume nts are passed through to</span>
<span class="sd">        the selected plotting routine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_args</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>

        <span class="n">plotters</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyz</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyuv</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyuv</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xyzuvw</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">plotters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unable to work out plot type !&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PlotMixin.plot_matrix"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">plot_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rectang</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwords</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a surface plot by assuming that the current dataset represents a regular matrix of points.</span>

<span class="sd">            Args:</span>
<span class="sd">                xvals (index, list or numpy.array): Either a column index or name or a list or numpytarray of column values. The default (None) uses the first column of data</span>
<span class="sd">                yvals (int or list): Either a row index or a list or numpy array of row values. The default (None) uses the column_headings interpreted as floats</span>
<span class="sd">                rectang (tuple):  a tuple of either 2 or 4 elements representing either the origin (row,column) or size (origin, number of rows, number of</span>
<span class="sd">                    columns) of data to be used for the z0data matrix</span>

<span class="sd">            Keyword Arguments:</span>
<span class="sd">                cmap (matplotlib colour map): Surface colour map - defaults to the jet colour map</span>
<span class="sd">                show_plot (bool): True Turns on interactive plot control</span>
<span class="sd">                title (string): Optional parameter that specfies the plot title - otherwise the current DataFile filename is used</span>
<span class="sd">                xlabel (string) X axes label. Deafult is None - guess from xvals or metadata</span>
<span class="sd">                ylabel (string): Y axes label, Default is None - guess from metadata</span>
<span class="sd">                zlabel (string): Z axis label, Default is None - guess from metadata</span>
<span class="sd">                figure (matplotlib figure): Controls what matplotlib figure to use. Can be an integer, or a matplotlib.figure or False. If False then a new figure is</span>
<span class="sd">                    always used, otherwise it will default to using the last figure used by this DataFile object.</span>
<span class="sd">                plotter (callable): Optional arguement that passes a plotting function into the routine. Sensible choices might be plt.plot (default), py.semilogy, plt.semilogx</span>
<span class="sd">                kwords (dict): A dictionary of other keyword arguments to pass into the plot function.</span>

<span class="sd">            Returns:</span>
<span class="sd">                The matplotib figure with the data plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sortout yvals values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1">#  Int means we&#39;re sepcifying a data row</span>
            <span class="k">if</span> <span class="n">rectang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># we need to intitialise the rectang</span>
                <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span><span class="n">yvals</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># We&#39;ll sort the column origin later</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">rectang</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">yvals</span>
            <span class="p">):</span>  <span class="c1"># We have a rectang, but we need to adjust the row origin</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yvals</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">yvals</span><span class="p">]</span>  <span class="c1"># change the yvals into a numpy array</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>  <span class="c1"># We&#39;re given the yvals as a list already</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No yvals, so we&#39;l try column headings</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">index_types</span><span class="p">):</span>  <span class="c1"># Do we have an xcolumn header to take away ?</span>
                <span class="n">xvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">xvals</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="n">xvals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No xvals so we&#39;re going to be using the first column</span>
                <span class="n">xvals</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_headers</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">])</span>  <span class="c1"># Ok try to construct yvals aray</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;uvals must be either an integer, list, tuple, numpy array or None&quot;</span><span class="p">)</span>
        <span class="c1"># Sort out xvls values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">index_types</span><span class="p">):</span>  <span class="c1"># String or int means using a column index</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rectang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Do we need to init the rectan ?</span>
                <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xvals</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rectang</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1"># Do we need to adjust the rectan column origin ?</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xvals</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>  <span class="c1"># Xvals as a data item</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">_np_</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">xvals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># xvals from column 0</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rectang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># and fix up rectang</span>
                <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;xvals must be a string, integer, list, tuple or numpy array or None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rectang</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rectang</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Sort the rectang value</span>
            <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">rectang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rectang</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rectang</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Ok, just make sure we have enough data points left.</span>
            <span class="n">rectang</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">rectang</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">rectang</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">_np_</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;rectang should either be a 2 or 4 tuple or None&quot;</span><span class="p">)</span>

        <span class="c1"># Now we can create X,Y and Z 2D arrays</span>
        <span class="n">zdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">yvals</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">rectang</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">)</span>

        <span class="c1"># This is the same as for the plot_xyz routine&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">mplfig</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SurfPlotter</span>
        <span class="n">plotter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwords</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="s2">&quot;X Data&quot;</span><span class="p">),</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="s2">&quot;Y Data&quot;</span><span class="p">),</span> <span class="s2">&quot;zlabel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">zlabel</span><span class="p">,</span> <span class="s2">&quot;Z Data&quot;</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s2">&quot;ylabel&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SurfPlotter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s2">&quot;zlabel&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span></div>

<div class="viewcode-block" id="PlotMixin.plot_xy"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot_xy">[docs]</a>    <span class="k">def</span> <span class="nf">plot_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes a simple X-Y plot of the specified data.</span>

<span class="sd">        Args:</span>
<span class="sd">            xcol (index): Column to be used for the X-Data</span>
<span class="sd">            ycol (index): column to be used for Y-Data - default value is column to the right of the x-data column</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            fmt (strong or sequence of strings): Specifies the format for the plot - see matplotlib documentation for details</span>
<span class="sd">            xerr,yerr (index): Columns of data to get x and y errorbars from. Setting these turns the default plotter to plt.errorbar</span>
<span class="sd">            xlabel (string) X axes label. Deafult is None - guess from xvals or metadata</span>
<span class="sd">            ylabel (string): Y axes label, Default is None - guess from metadata</span>
<span class="sd">            zlabel (string): Z axis label, Default is None - guess from metadata</span>
<span class="sd">            title (string): Optional parameter that specfies the plot title - otherwise the current DataFile filename is used</span>
<span class="sd">            plotter (function): Function to use to plot data. Defaults to plt.plot unless error bars are set</span>
<span class="sd">            show_plot (bool): Turn on interfactive plotting and show plot when drawn</span>
<span class="sd">            save_filename (string or None): If set to a string, save the plot with this filename</span>
<span class="sd">            figure (integer or matplotlib.figure or boolean): Controls which figure is used for the plot, or if a new figure is opened.</span>
<span class="sd">            multiple (string): how to handle multiple y-axes with a common x axis. Options are:</span>

<span class="sd">                - *common* single y-axis (default)</span>
<span class="sd">                - *panels* panels sharing common x axis</span>
<span class="sd">                - *sub plots* sub plots</span>
<span class="sd">                - *y2* single axes with 2 y scales</span>

<span class="sd">            **kargs (dict): Other arguments are passed on to the plotter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib.figure isntance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">multi_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;xerr&quot;</span><span class="p">],</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;yerr&quot;</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xerr</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">yerr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span>
            <span class="s2">&quot;show_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
            <span class="s2">&quot;save_filename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">)),</span>
            <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">otherargs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;plotter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">xerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">yerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># USe and errorbar blotter by default for errors</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span>
            <span class="n">otherargs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;agg_filter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
                <span class="s2">&quot;animated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;antialiased&quot;</span><span class="p">,</span>
                <span class="s2">&quot;aa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;axes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_box&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_on&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">,</span>
                <span class="s2">&quot;c&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dash_capstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dash_joinstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dashes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;drawstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fillstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linestyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ls&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linewidth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lw&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lod&quot;</span><span class="p">,</span>
                <span class="s2">&quot;marker&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markeredgecolor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mec&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markeredgewidth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mew&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markerfacecolor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mfc&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markerfacecoloralt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mfcalt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markersize&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markevery&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path_effects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;picker&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pickradius&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rasterized&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sketch_params&quot;</span><span class="p">,</span>
                <span class="s2">&quot;snap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;solid_capstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;solid_joinstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transform&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">,</span>
                <span class="s2">&quot;xdata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ydata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;zorder&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;plotter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span>
            <span class="n">otherargs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;agg_filter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
                <span class="s2">&quot;animated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;antialiased&quot;</span><span class="p">,</span>
                <span class="s2">&quot;aa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;axes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_box&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_on&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clip_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">,</span>
                <span class="s2">&quot;c&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dash_capstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dash_joinstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dashes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;drawstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fillstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linestyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ls&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linewidth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lw&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lod&quot;</span><span class="p">,</span>
                <span class="s2">&quot;marker&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markeredgecolor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mec&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markeredgewidth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mew&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markerfacecolor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mfc&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markerfacecoloralt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mfcalt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markersize&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;markevery&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path_effects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;picker&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pickradius&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rasterized&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sketch_params&quot;</span><span class="p">,</span>
                <span class="s2">&quot;snap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;solid_capstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;solid_joinstyle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transform&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="s2">&quot;visible&quot;</span><span class="p">,</span>
                <span class="s2">&quot;xdata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ydata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;zorder&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="n">multiple</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;multiple&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span><span class="p">)</span>

        <span class="n">kargs</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">fig_kargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_kargs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">otherargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xerr&quot;</span><span class="p">,</span> <span class="s2">&quot;yerr&quot;</span><span class="p">]:</span>  <span class="c1"># Check for x and y error keywords</span>
            <span class="k">if</span> <span class="n">isNone</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">],</span> <span class="n">index_types</span><span class="p">):</span>
                <span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">):</span>
                <span class="c1"># Ok, so it&#39;s a list, so redo the check for each  item.</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">index_types</span><span class="p">):</span>
                        <span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">isiterable</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kargs</span><span class="p">[</span><span class="n">err</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">temp_kwords</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="p">(</span><span class="n">index_types</span><span class="p">)):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">ycol</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple</span> <span class="o">==</span> <span class="s2">&quot;panels&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hspace&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">multiple</span> <span class="o">==</span> <span class="s2">&quot;subplots&quot;</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">))))</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np_</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">fig_kargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">fig_kargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">multiple</span> <span class="o">!=</span> <span class="s2">&quot;common&quot;</span><span class="p">:</span>
                <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;ylabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">ix</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">multiple</span> <span class="o">==</span> <span class="s2">&quot;y2&quot;</span> <span class="ow">and</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">()</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">_get_lines</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="s2">&quot;color_cycle&quot;</span><span class="p">):</span>  <span class="c1"># mpl&lt;1.5</span>
                        <span class="n">cc</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">color_cycle</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># MPL &gt;=1.5</span>
                        <span class="n">cc</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">prop_cycler</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
                        <span class="nb">next</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">multiple</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span> <span class="s2">&quot;panels&quot;</span><span class="p">,</span> <span class="s2">&quot;subplots&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ix</span>  <span class="c1"># We&#39;re manipulating the plotting here</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># Fix up the format</span>
                <span class="n">fmt_t</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt_t</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># Fix label keywords</span>
                <span class="n">temp_kwords</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;yerr&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;yerr&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># Fix yerr keywords</span>
                <span class="n">temp_kwords</span><span class="p">[</span><span class="s2">&quot;yerr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;yerr&quot;</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span>
            <span class="c1"># Call plot</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_Plot</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">fmt_t</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="o">**</span><span class="n">temp_kwords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fix_titles</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">multiple</span><span class="p">,</span> <span class="o">**</span><span class="n">nonkargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ix</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Hooks for multiple subplots</span>
                <span class="k">if</span> <span class="n">multiple</span> <span class="o">==</span> <span class="s2">&quot;panels&quot;</span><span class="p">:</span>
                    <span class="n">loc</span><span class="p">,</span> <span class="n">lab</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">()</span>
                    <span class="n">lab</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lab</span><span class="p">]</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">loc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lab</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span></div>

<div class="viewcode-block" id="PlotMixin.plot_xyz"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">plot_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a surface plot based on rows of X,Y,Z data using matplotlib.pcolor().</span>

<span class="sd">            Args:</span>
<span class="sd">                xcol (index): Xcolumn index or label</span>
<span class="sd">                ycol (index): Y column index or label</span>
<span class="sd">                zcol (index): Z column index or label</span>

<span class="sd">            Keyword Arguments:</span>
<span class="sd">                shape (tuple): Defines the shape of the surface (i.e. the number of X and Y value. If not procided or None, then the routine will attempt to calculate</span>
<span class="sd">                    these from the data provided</span>
<span class="sd">                xlim (tuple): Defines the x-axis limits and grid of the data to be plotted</span>
<span class="sd">                ylim (tuple) Defines the Y-axis limits and grid of the data data to be plotted</span>
<span class="sd">                cmap (matplotlib colour map): Surface colour map - defaults to the jet colour map</span>
<span class="sd">                show_plot (bool): True Turns on interactive plot control</span>
<span class="sd">                title (string): Optional parameter that specfies the plot title - otherwise the current DataFile filename is used</span>
<span class="sd">                save_filename (string): Filename used to save the plot</span>
<span class="sd">                figure (matplotlib figure): Controls what matplotlib figure to use. Can be an integer, or a matplotlib.figure or False. If False then a new figure is</span>
<span class="sd">                    always used, otherwise it will default to using the last figure used by this DataFile object.</span>
<span class="sd">                plotter (callable): Optional arguement that passes a plotting function into the routine. Default is a 3d surface plotter, but contour plot and pcolormesh also work.</span>
<span class="sd">                projection (string or None): Whether to use a 3D projection or regular 2D axes (deault is 3D)</span>
<span class="sd">                **kargs (dict): A dictionary of other keyword arguments to pass into the plot function.</span>

<span class="sd">            Returns:</span>
<span class="sd">                A matplotlib.figure isntance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_3D</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;3D plotting Not available. Install matplotlib toolkits&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="n">zcol</span><span class="p">,</span> <span class="n">multi_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">zdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">zcol</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>  <span class="c1"># Catch template in kargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SurfPlotter</span><span class="p">,</span>
            <span class="s2">&quot;show_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span>
            <span class="s2">&quot;save_filename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
            <span class="s2">&quot;rstride&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)),</span>
            <span class="s2">&quot;cstride&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)),</span>
        <span class="p">}</span>
        <span class="n">coltypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="s2">&quot;zlabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">zcol</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coltypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coltypes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">index_types</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">coltypes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
        <span class="k">if</span> <span class="s2">&quot;plotter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;plotter&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SurfPlotter</span><span class="p">):</span>
            <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;rstride&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cstride&quot;</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;facecolors&quot;</span><span class="p">,</span>
                <span class="s2">&quot;norm&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vmin&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vmax&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shade&quot;</span><span class="p">,</span>
                <span class="s2">&quot;linewidth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ax&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="s2">&quot;shade&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">]</span>
        <span class="n">kargs</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_kargs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">otherkargs</span><span class="o">=</span><span class="n">otherkargs</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotter</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">plotter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot3d</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">zdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SurfPlotter</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;zlabel&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_titles</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">nonkargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span></div>

<div class="viewcode-block" id="PlotMixin.plot_xyuv"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot_xyuv">[docs]</a>    <span class="k">def</span> <span class="nf">plot_xyuv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes an overlaid image and quiver plot.</span>

<span class="sd">            Args:</span>
<span class="sd">                xcol (index): Xcolumn index or label</span>
<span class="sd">                ycol (index): Y column index or label</span>
<span class="sd">                zcol (index): Z column index or label</span>
<span class="sd">                ucol (index): U column index or label</span>
<span class="sd">                vcol (index): V column index or label</span>
<span class="sd">                wcol (index): W column index or label</span>

<span class="sd">            Keyword Arguments:</span>
<span class="sd">                show_plot (bool): True Turns on interactive plot control</span>
<span class="sd">                title (string): Optional parameter that specfies the plot title - otherwise the current DataFile filename is used</span>
<span class="sd">                save_filename (string): Filename used to save the plot</span>
<span class="sd">                figure (matplotlib figure): Controls what matplotlib figure to use. Can be an integer, or a matplotlib.figure or False. If False then a new figure is</span>
<span class="sd">                    always used, otherwise it will default to using the last figure used by this DataFile object.</span>
<span class="sd">                plotter (callable): Optional arguement that passes a plotting function into the routine. Default is a 3d surface plotter, but contour plot and pcolormesh also work.</span>
<span class="sd">                **kargs (dict): A dictionary of other keyword arguments to pass into the plot function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="n">ucol</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="n">vcol</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="n">wcol</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_color</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="n">ucol</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="n">vcol</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="n">wcol</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>  <span class="c1"># Catch template in kargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;save_filename&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;save_filename&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;save_filename&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_plot</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># stop saving file twice</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;save_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiver_plot</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ucol</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">vcol</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="n">plot_xyuvw</span> <span class="o">=</span> <span class="n">plot_xyuv</span>

<div class="viewcode-block" id="PlotMixin.plot_xyzuvw"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.plot_xyzuvw">[docs]</a>    <span class="k">def</span> <span class="nf">plot_xyzuvw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots a vector field plot based on rows of X,Y,Z (U,V,W) data using ,ayavi.</span>

<span class="sd">            Args:</span>
<span class="sd">                xcol (index): Xcolumn index or label</span>
<span class="sd">                ycol (index): Y column index or label</span>
<span class="sd">                zcol (index): Z column index or label</span>
<span class="sd">                ucol (index): U column index or label</span>
<span class="sd">                vcol (index): V column index or label</span>
<span class="sd">                wcol (index): W column index or label</span>

<span class="sd">            Keyword Arguments:</span>
<span class="sd">                colormap (string): Vector field colour map - defaults to the jet colour map</span>
<span class="sd">                colors (column index or numpy array): Values used to map the colors of the resultant file.</span>
<span class="sd">                mode (string): glyph type, default is &quot;cone&quot;</span>
<span class="sd">                scale_factor(float): Scale-size of glyphs.</span>
<span class="sd">                figure (mlab figure): Controls what mlab figure to use. Can be an integer, or a mlab.figure or False. If False then a new figure is always used,</span>
<span class="sd">                    otherwise it will default to using the last figure used by this DataFile object.</span>
<span class="sd">                plotter (callable): Optional arguement that passes a plotting function into the routine. Sensible choices might be plt.plot (default), py.semilogy, plt.semilogx</span>
<span class="sd">                kargs (dict): A dictionary of other keyword arguments to pass into the plot function.</span>

<span class="sd">            Returns:</span>
<span class="sd">                A mayavi scene instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span><span class="p">,</span> <span class="n">core</span>

            <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">mayavi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">mayavi</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">zcol</span><span class="o">=</span><span class="n">zcol</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="n">ucol</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="n">vcol</span><span class="p">,</span> <span class="n">wcol</span><span class="o">=</span><span class="n">wcol</span><span class="p">,</span> <span class="n">multi_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>  <span class="c1"># Catch template in kargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mayavi</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
                <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VectorFieldPlot</span><span class="p">,</span>
                <span class="s2">&quot;show_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;cone&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;colors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;color&quot;</span><span class="p">,</span>
                <span class="s2">&quot;colormap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;extent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;figure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;line_width&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mask_points&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;opacity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reset_zoom&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resolution&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scalars&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scale_mode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transparent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vmax&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vmin&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mpl3DQuiver</span><span class="p">,</span>
                <span class="s2">&quot;show_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span>
                <span class="s2">&quot;save_filename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">hsl2rgb</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">/</span> <span class="n">_np_</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">_np_</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">projection</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="s2">&quot;3d&quot;</span><span class="p">)</span>
            <span class="n">coltypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">,</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">,</span> <span class="s2">&quot;zlabel&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">zcol</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coltypes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coltypes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">index_types</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="n">coltypes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                    <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
            <span class="k">if</span> <span class="s2">&quot;plotter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;plotter&quot;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mpl3DQuiver</span><span class="p">):</span>
                <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;pivot&quot;</span><span class="p">,</span> <span class="s2">&quot;arrow_length_ratio&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">]</span>

        <span class="n">kargs</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_kargs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">otherkargs</span><span class="o">=</span><span class="n">otherkargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colors</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">index_types</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">_np_</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">colors</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">()])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Do not recognise what to do with the colors keyword.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mayavi</span><span class="p">:</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">]</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mayavi</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">figure</span><span class="p">:</span>
                <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">Scene</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">Scene</span><span class="p">):</span>
                <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figure</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="o">=</span> <span class="n">figure</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotter</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">plotter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">plotter</span><span class="p">)</span>

        <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="n">plotter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xcol</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ycol</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">zcol</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ucol</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">vcol</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">wcol</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;show_plot&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">mayavi</span><span class="p">:</span>
                <span class="n">mlab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span></div>

<div class="viewcode-block" id="PlotMixin.quiver_plot"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.quiver_plot">[docs]</a>    <span class="k">def</span> <span class="nf">quiver_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a 2D Quiver plot from the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            xcol (index): Xcolumn index or label</span>
<span class="sd">            ycol (index): Y column index or label</span>
<span class="sd">            zcol (index): Z column index or label</span>
<span class="sd">            ucol (index): U column index or label</span>
<span class="sd">            vcol (index): V column index or label</span>
<span class="sd">            wcol (index): W column index or label</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            xlabel (string) X axes label. Deafult is None - guess from xvals or metadata</span>
<span class="sd">            ylabel (string): Y axes label, Default is None - guess from metadata</span>
<span class="sd">            zlabel (string): Z axis label, Default is None - guess from metadata</span>
<span class="sd">            plotter (function): Function to use to plot data. Defaults to plt.contour</span>
<span class="sd">            headlength,headwidth,headaxislength (float): Controls the size of the quiver heads</span>
<span class="sd">            show_plot (bool): Turn on interfactive plotting and show plot when drawn</span>
<span class="sd">            save_filename (string or None): If set to a string, save the plot with this filename</span>
<span class="sd">            figure (integer or matplotlib.figure or boolean): Controls which figure is used for the plot, or if a new figure is opened.</span>
<span class="sd">            **kargs (dict): Other arguments are passed on to the plotter.</span>


<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib figure instance.</span>

<span class="sd">        Keyword arguments are all passed through to :py:func:`matplotlib.plt.quiver`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fix_cols</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">ucol</span><span class="o">=</span><span class="n">ucol</span><span class="p">,</span> <span class="n">vcol</span><span class="o">=</span><span class="n">vcol</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pivot&quot;</span><span class="p">:</span> <span class="s2">&quot;mid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="s2">&quot;headlength&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;headaxislength&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;headwidth&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plotter&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">,</span>
            <span class="s2">&quot;show_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span>
            <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">xcol</span><span class="p">)),</span>
            <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">ycol</span><span class="p">)),</span>
        <span class="p">}</span>
        <span class="n">otherkargs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;units&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angles&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scale_units&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">,</span>
            <span class="s2">&quot;headwidth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;headlength&quot;</span><span class="p">,</span>
            <span class="s2">&quot;headaxislength&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minshaft&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minlength&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pivot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>  <span class="c1"># Catch template in kargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>

        <span class="n">kargs</span><span class="p">,</span> <span class="n">nonkargs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_kargs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">otherkargs</span><span class="o">=</span><span class="n">otherkargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;plotter&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_fig</span><span class="p">(</span><span class="n">nonkargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">])</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">xcol</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">ycol</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">ucol</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_col</span><span class="p">(</span><span class="n">vcol</span><span class="p">)),</span>
            <span class="o">**</span><span class="n">kargs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_titles</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">nonkargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="PlotMixin.subplot"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.subplot">[docs]</a>    <span class="k">def</span> <span class="nf">subplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pass throuygh for plt.subplot().</span>

<span class="sd">        Args:</span>
<span class="sd">            rows (int): If this is the only argument, then a three digit number representing</span>
<span class="sd">                the rows,columns,index arguments. If seperate rows, column and index are provided,</span>
<span class="sd">                then this is the number of rows of sub-plots in one figure.</span>
<span class="sd">            columns (int): The number of columns of sub-plots in one figure.</span>
<span class="sd">            index (int): Index (1 based) of the current sub-plot.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A matplotlib.Axes instance representing the current sub-plot</span>

<span class="sd">        As well as passing through to the plyplot routine of the same name, this</span>
<span class="sd">        function maintains a list of the current sub-plot axes via the subplots attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">100</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subplots</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span>
        <span class="k">return</span> <span class="n">sp</span></div>

<div class="viewcode-block" id="PlotMixin.subplot2grid"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.subplot2grid">[docs]</a>    <span class="k">def</span> <span class="nf">subplot2grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Pass through to :py:func:`matplotlib.pyplot.subplot2grid`.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="n">figure</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">new_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PlotMixin.x2"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.x2">[docs]</a>    <span class="k">def</span> <span class="nf">x2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a new set of axes with a second x-scale.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new matplotlib.axes instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax2</span></div>

<div class="viewcode-block" id="PlotMixin.y2"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotMixin.html#Stoner.PlotMixin.y2">[docs]</a>    <span class="k">def</span> <span class="nf">y2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a new set of axes with a second y-scale.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new matplotlib.axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__figure</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax2</span></div></div>


<div class="viewcode-block" id="hsl2rgb"><a class="viewcode-back" href="../../../classes/Stoner.plot.hsl2rgb.html#Stoner.hsl2rgb">[docs]</a><span class="k">def</span> <span class="nf">hsl2rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts from hsl colourspace to rgb colour space with numpy arrays for speed.</span>

<span class="sd">    Args:</span>
<span class="sd">        h (array): Hue value</span>
<span class="sd">        s (array): Saturation value</span>
<span class="sd">        l (array): Luminence value</span>

<span class="sd">    Returns:</span>
<span class="sd">        2D array (Mx3) of unsigned 8bit integers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">h</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">l</span><span class="o">.</span><span class="n">shape</span> <span class="ow">or</span> <span class="n">h</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Must have equal shaped arrays for h, s and l&quot;</span><span class="p">)</span>

    <span class="n">rgb</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">hls</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)):</span>
        <span class="n">rgb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">_np_</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hls_to_rgb</span><span class="p">(</span><span class="o">*</span><span class="n">hls</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">rgb</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;u1&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotFile"><a class="viewcode-back" href="../../../classes/Stoner.plot.PlotFile.html#Stoner.PlotFile">[docs]</a><span class="k">def</span> <span class="nf">PlotFile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Issue a warning and then create a class anyway.&quot;&quot;&quot;</span>
    <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;PlotFile is deprecated in favour of Stoner.Data or the PlotMixin&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">Stoner.Core</span> <span class="k">as</span> <span class="nn">_SC_</span>

    <span class="k">class</span> <span class="nc">PlotFile</span><span class="p">(</span><span class="n">PlotMixin</span><span class="p">,</span> <span class="n">_SC_</span><span class="o">.</span><span class="n">DataFile</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Extends DataFile with plotting functions from :py:class:`Stoner.Plot.PlotMixin`&quot;&quot;&quot;</span>

        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">PlotFile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/StonerLogo2.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Stoner Package</a></li>
      <li>
        <a href="../../index.html">Module code</a>
      </li>
      <li>
        <a href="../../Stoner.html">Stoner</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2013-15, Gavin Burnell et al.Last updated on Apr 22, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      1.7.9
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>